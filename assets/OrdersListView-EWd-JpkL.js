import{_ as y,h as O,r as b,o as r,c as _,d as p,b as s,t as l,F as P,i as k,w as g,e as v,j as w,n as d,p as T,f as S,g as A}from"./index-A2IetPGn.js";import{P as x}from"./PaginationComponent-swG4qX5S.js";import{H as L}from"./HeroSection-HOj-3nC5.js";var C={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"vue001",BASE_URL:"/vue_practise_w7/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const N={name:"OrdersListView",components:{PaginationComponent:x,HeroSection:L},data(){return{orders:[],pagination:{total_pages:1,current_page:1,has_pre:!1,has_next:!1},isLoading:!1,error:null}},computed:{statistics(){const t=this.orders.length,a=this.orders.filter(c=>!c.is_paid).length,h=this.orders.filter(c=>c.is_paid).length,n=this.orders.reduce((c,i)=>{const u=this.getOrderTotalNumber(i);return c+u},0);return{totalOrders:t,pendingOrders:a,completedOrders:h,totalAmount:Math.round(n).toLocaleString()}}},methods:{async fetchOrders(t=1){var a,h;try{this.isLoading=!0,this.error=null;const{VITE_APP_URL:n,VITE_APP_PATH:c}=C,i=await O.get(`${n}/api/${c}/orders?page=${t}`);if(i.data.success)this.orders=i.data.orders,this.pagination=i.data.pagination;else throw new Error("獲取訂單列表失敗")}catch(n){this.error=((h=(a=n.response)==null?void 0:a.data)==null?void 0:h.message)||n.message||"獲取訂單列表失敗"}finally{this.isLoading=!1}},changePage(t){t>=1&&t<=this.pagination.total_pages&&(this.fetchOrders(t),window.scrollTo({top:0,behavior:"smooth"}))},formatDate(t){return t?new Date(t*1e3).toLocaleDateString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):""},getProductCount(t){return t.products?Array.isArray(t.products)?t.products.length:typeof t.products=="object"?Object.keys(t.products).length:0:0},calculateOrderTotal(t){const a=this.getOrderTotalNumber(t);return Math.round(a).toLocaleString()},getOrderTotalNumber(t){if(!t.products)return Number(t.total||0);const a=Array.isArray(t.products)?t.products:Object.values(t.products);if(a.some(n=>n.coupon)){const n=a.reduce((i,u)=>i+Number(u.total||0),0),c=Number(t.total||0);return n-c}return Number(t.total||0)},getStatusClass(t){return t.is_paid?"completed":"pending"},getStatusText(t){return t.is_paid?"已完成":"處理中"}},mounted(){this.fetchOrders()}},o=t=>(T("data-v-e802f577"),t=t(),S(),t),V={class:"orders-list-view"},E={class:"container-fluid px-4"},I={class:"statistics-dashboard mb-5"},D={class:"row g-4"},R={class:"col-lg-auto col-md-4 col-sm-6"},H={class:"stat-card"},j=o(()=>s("div",{class:"stat-icon total"},[s("i",{class:"bi bi-list-check"})],-1)),B={class:"stat-content"},M={class:"stat-number"},U=o(()=>s("p",{class:"stat-label"},"總訂單數",-1)),z={class:"col-lg-auto col-md-4 col-sm-6"},F={class:"stat-card"},W=o(()=>s("div",{class:"stat-icon pending"},[s("i",{class:"bi bi-clock-history"})],-1)),q={class:"stat-content"},G={class:"stat-number"},J=o(()=>s("p",{class:"stat-label"},"待付款",-1)),K={class:"col-lg-auto col-md-4 col-sm-6"},Q={class:"stat-card"},X=o(()=>s("div",{class:"stat-icon completed"},[s("i",{class:"bi bi-check-circle"})],-1)),Y={class:"stat-content"},Z={class:"stat-number"},$=o(()=>s("p",{class:"stat-label"},"已完成",-1)),ss={class:"col-lg-5 col-md-12 col-sm-6"},ts={class:"stat-card"},os=o(()=>s("div",{class:"stat-icon amount"},[s("i",{class:"bi bi-currency-dollar"})],-1)),is={class:"stat-content"},es={class:"stat-number"},cs=o(()=>s("p",{class:"stat-label"},"累計金額",-1)),as={class:"row"},ns={class:"col-12"},ls={key:0,class:"loading-container"},ds=A('<div class="loading-animation" data-v-e802f577><div class="loading-spinner" data-v-e802f577><div class="bounce1" data-v-e802f577></div><div class="bounce2" data-v-e802f577></div><div class="bounce3" data-v-e802f577></div></div><h4 class="loading-text" data-v-e802f577>正在載入您的訂單</h4><p class="loading-subtitle" data-v-e802f577>請稍候片刻...</p></div>',1),rs=[ds],_s={key:1,class:"orders-container"},hs={class:"card border-0 shadow-sm"},us={class:"card-body p-4"},ps={class:"order-progress mb-4"},vs=o(()=>s("div",{class:"step-icon"},[s("i",{class:"bi bi-bag-check"})],-1)),ms=o(()=>s("span",{class:"step-label"},"訂單確認",-1)),bs=[vs,ms],gs=o(()=>s("div",{class:"step-icon"},[s("i",{class:"bi bi-credit-card"})],-1)),fs=o(()=>s("span",{class:"step-label"},"付款完成",-1)),ys=[gs,fs],Os=o(()=>s("div",{class:"step-icon"},[s("i",{class:"bi bi-truck"})],-1)),Ps=o(()=>s("span",{class:"step-label"},"配送中",-1)),ks=[Os,Ps],ws=o(()=>s("div",{class:"step-icon"},[s("i",{class:"bi bi-house-check"})],-1)),Ts=o(()=>s("span",{class:"step-label"},"已送達",-1)),Ss=[ws,Ts],As={class:"row align-items-center g-3"},xs={class:"col-lg-2 col-md-3 col-sm-6"},Ls={class:"order-info-item"},Cs=o(()=>s("div",{class:"info-icon"},[s("i",{class:"bi bi-hash"})],-1)),Ns={class:"info-content"},Vs=o(()=>s("h6",{class:"info-label"},"訂單編號",-1)),Es={class:"info-value"},Is={class:"col-lg-2 col-md-3 col-sm-6"},Ds={class:"order-info-item"},Rs=o(()=>s("div",{class:"info-icon"},[s("i",{class:"bi bi-calendar3"})],-1)),Hs={class:"info-content"},js=o(()=>s("h6",{class:"info-label"},"訂單日期",-1)),Bs={class:"info-value"},Ms={class:"col-lg-2 col-md-3 col-sm-6"},Us={class:"order-info-item"},zs=o(()=>s("div",{class:"info-icon"},[s("i",{class:"bi bi-credit-card"})],-1)),Fs={class:"info-content"},Ws=o(()=>s("h6",{class:"info-label"},"付款狀態",-1)),qs={class:"col-lg-2 col-md-3 col-sm-6"},Gs={class:"order-info-item"},Js=o(()=>s("div",{class:"info-icon"},[s("i",{class:"bi bi-box-seam"})],-1)),Ks={class:"info-content"},Qs=o(()=>s("h6",{class:"info-label"},"商品數量",-1)),Xs={class:"info-value"},Ys={class:"col-lg-2 col-md-6 col-sm-6"},Zs={class:"order-info-item"},$s=o(()=>s("div",{class:"info-icon total-icon"},[s("i",{class:"bi bi-currency-dollar"})],-1)),st={class:"info-content"},tt=o(()=>s("h6",{class:"info-label"},"訂單總額",-1)),ot={class:"info-value total-amount"},it={class:"col-lg-2 col-md-6 col-sm-6"},et={class:"order-actions"},ct=o(()=>s("i",{class:"bi bi-eye me-1"},null,-1)),at={key:2,class:"empty-state"},nt={class:"empty-illustration"},lt=o(()=>s("div",{class:"empty-icon"},[s("i",{class:"bi bi-bag-x"})],-1)),dt={class:"empty-content"},rt=o(()=>s("h3",{class:"empty-title"},"還沒有任何訂單",-1)),_t=o(()=>s("p",{class:"empty-subtitle"}," 快去探索我們精選的商品，開始您的購物之旅吧！ ",-1)),ht={class:"empty-actions"},ut=o(()=>s("i",{class:"bi bi-bag-plus me-2"},null,-1)),pt=o(()=>s("i",{class:"bi bi-house me-2"},null,-1)),vt={key:3,class:"error-state"},mt=o(()=>s("div",{class:"error-icon"},[s("i",{class:"bi bi-exclamation-triangle"})],-1)),bt=o(()=>s("h4",{class:"error-title"},"載入失敗",-1)),gt={class:"error-message"},ft=o(()=>s("i",{class:"bi bi-arrow-clockwise me-2"},null,-1));function yt(t,a,h,n,c,i){const u=b("HeroSection"),m=b("RouterLink"),f=b("PaginationComponent");return r(),_("div",V,[p(u,{title:"我的訂單",subtitle:"管理您的所有訂單，追蹤購買記錄","icon-class":"bi bi-receipt-cutoff"}),s("div",E,[s("div",I,[s("div",D,[s("div",R,[s("div",H,[j,s("div",B,[s("h3",M,l(i.statistics.totalOrders),1),U])])]),s("div",z,[s("div",F,[W,s("div",q,[s("h3",G,l(i.statistics.pendingOrders),1),J])])]),s("div",K,[s("div",Q,[X,s("div",Y,[s("h3",Z,l(i.statistics.completedOrders),1),$])])]),s("div",ss,[s("div",ts,[os,s("div",is,[s("h3",es,"NT$ "+l(i.statistics.totalAmount),1),cs])])])])]),s("div",as,[s("div",ns,[c.isLoading?(r(),_("div",ls,rs)):c.orders.length>0?(r(),_("div",_s,[(r(!0),_(P,null,k(c.orders,e=>(r(),_("div",{key:e.id,class:"order-card mb-4"},[s("div",hs,[s("div",{class:d(["order-status-ribbon",i.getStatusClass(e)])},[s("span",null,l(i.getStatusText(e)),1)],2),s("div",us,[s("div",ps,[s("div",{class:d(["progress-step",{active:!0}])},bs),s("div",{class:d(["progress-line",{active:e.is_paid}])},null,2),s("div",{class:d(["progress-step",{active:e.is_paid}])},ys,2),s("div",{class:d(["progress-line",{active:e.is_paid}])},null,2),s("div",{class:d(["progress-step",{active:e.is_paid}])},ks,2),s("div",{class:d(["progress-line",{active:e.is_paid}])},null,2),s("div",{class:d(["progress-step",{active:e.is_paid}])},Ss,2)]),s("div",As,[s("div",xs,[s("div",Ls,[Cs,s("div",Ns,[Vs,s("p",Es,l(e.id.substring(0,8))+"... ",1)])])]),s("div",Is,[s("div",Ds,[Rs,s("div",Hs,[js,s("p",Bs,l(i.formatDate(e.create_at)),1)])])]),s("div",Ms,[s("div",Us,[zs,s("div",Fs,[Ws,s("span",{class:d(["payment-badge",e.is_paid?"paid":"unpaid"])},[s("i",{class:d(e.is_paid?"bi bi-check-circle":"bi bi-exclamation-circle")},null,2),v(" "+l(e.is_paid?"已付款":"待付款"),1)],2)])])]),s("div",qs,[s("div",Gs,[Js,s("div",Ks,[Qs,s("p",Xs,l(i.getProductCount(e))+" 項 ",1)])])]),s("div",Ys,[s("div",Zs,[$s,s("div",st,[tt,s("p",ot," NT$ "+l(i.calculateOrderTotal(e)),1)])])]),s("div",it,[s("div",et,[p(m,{to:`/order/${e.id}`,class:"btn btn-primary btn-sm"},{default:g(()=>[ct,v(" 查看詳情 ")]),_:2},1032,["to"])])])])])])]))),128)),p(f,{pagination:c.pagination,"aria-label":"訂單分頁",onChangePage:i.changePage},null,8,["pagination","onChangePage"])])):(r(),_("div",at,[s("div",nt,[lt,s("div",dt,[rt,_t,s("div",ht,[p(m,{to:"/products",class:"btn btn-primary btn-lg"},{default:g(()=>[ut,v(" 開始購物 ")]),_:1}),p(m,{to:"/",class:"btn btn-outline-primary btn-lg ms-3"},{default:g(()=>[pt,v(" 回到首頁 ")]),_:1})])])])])),c.error?(r(),_("div",vt,[mt,bt,s("p",gt,l(c.error),1),s("button",{class:"btn btn-primary",onClick:a[0]||(a[0]=(...e)=>i.fetchOrders&&i.fetchOrders(...e))},[ft,v(" 重新載入 ")])])):w("",!0)])])])])}const wt=y(N,[["render",yt],["__scopeId","data-v-e802f577"]]);export{wt as default};
