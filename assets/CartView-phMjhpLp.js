import{_ as w,R as x,k,a as y,r as I,o as c,c as i,b as t,F as S,h as L,l as g,v as f,t as d,n as u,d as p,w as b,e as _,q as N,p as T,i as q}from"./index-5uWLd9w3.js";import{u as C}from"./cartStore-HCPQo-0e.js";import{u as v}from"./toastMessage-OX34INNF.js";const A={components:{RouterLink:x},data(){return{loadingItem:"",isClearing:!1,couponCode:"",isApplyingCoupon:!1}},computed:{...k(C,v),showCoupon(){var e,o;return!!((o=(e=this.cartStore)==null?void 0:e.carts[0])!=null&&o.coupon)},discountAmount(){const e=this.cartStore.total-this.cartStore.final_total;return Math.round(e)}},methods:{...y(C,["getCart","updateCartItem","removeCartItem","clearCart","applyCoupon"]),...y(v,["addMessage"]),formatPrice(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},async updateCartItemLocal(e){this.loadingItem=e.id;try{await this.updateCartItem(e)}catch(o){console.error("更新購物車項目失敗:",o)}finally{this.loadingItem=""}},updateQuantity(e,o){if(o>=1&&o<=20){const m={...e,qty:o};this.updateCartItemLocal(m)}},async removeCartItemLocal(e){this.loadingItem=e;try{await this.removeCartItem(e)}catch(o){console.error("移除購物車項目失敗:",o)}finally{this.loadingItem=""}},async clearCartLocal(){this.isClearing=!0;try{await this.clearCart()}catch(e){console.error("清空購物車失敗:",e)}finally{this.isClearing=!1}},async applyCouponLocal(){if(!this.couponCode){this.addMessage({title:"提示",content:"請輸入優惠碼",style:"warning"});return}this.isApplyingCoupon=!0;try{await this.applyCoupon(this.couponCode),this.couponCode=""}catch{}finally{this.isApplyingCoupon=!1}}},mounted(){this.getCart()}},a=e=>(T("data-v-c0660dbe"),e=e(),q(),e),V={class:"container my-5"},j=a(()=>t("h2",{class:"fw-bold mb-4"},"購物車",-1)),P={key:0},M={class:"table-responsive"},B={class:"table align-middle"},R=a(()=>t("thead",{class:"bg-light"},[t("tr",null,[t("th",{class:"py-3"},"商品資訊"),t("th",{class:"py-3 text-center",style:{width:"180px"}},"數量"),t("th",{class:"py-3 text-end"},"單價"),t("th",{class:"py-3 text-end"},"小計"),t("th",{class:"py-3 text-center"},"操作")])],-1)),U={class:"d-flex align-items-center"},D={class:"me-3",style:{width:"80px",height:"80px"}},F=["src","alt"],z={class:"mb-1"},E={class:"text-muted"},Q={key:0,class:"badge bg-success mt-1"},G={class:"input-group quantity-selector mx-auto",style:{"max-width":"140px"}},H=["onClick","disabled"],J=a(()=>t("i",{class:"bi bi-dash"},null,-1)),K=[J],O=["onUpdate:modelValue","onChange","disabled"],W=["onClick","disabled"],X=a(()=>t("i",{class:"bi bi-plus"},null,-1)),Y=[X],Z={class:"text-end"},$={class:"fw-medium"},tt={key:0,class:"text-muted text-decoration-line-through small"},st={class:"text-end fw-bold"},et={class:"text-center"},ot=["onClick","disabled"],nt={key:0,class:"bi bi-arrow-clockwise spinner-icon"},at={key:1,class:"bi bi-trash"},ct=a(()=>t("span",{class:"ms-1 d-none d-sm-inline"},"刪除",-1)),it={class:"card mt-4 border-0 shadow-sm"},lt={class:"card-body p-4"},dt={class:"row"},rt={class:"col-md-6 d-flex align-items-center mb-md-0 mb-3"},ut=["disabled"],_t=["disabled"],ht={key:0,class:"bi bi-arrow-clockwise spinner-icon"},pt={key:1},bt={class:"col-md-6"},mt={class:"d-flex justify-content-between align-items-center mb-2"},yt=a(()=>t("span",{class:"text-muted"},"商品小計：",-1)),gt=a(()=>t("div",{class:"d-flex justify-content-between align-items-center mb-2"},[t("span",{class:"text-muted"},"運費："),t("span",null,"NT$ 0")],-1)),ft={key:0,class:"d-flex justify-content-between align-items-center mb-2"},Ct=a(()=>t("span",{class:"text-muted"},"已套用優惠券：",-1)),vt={class:"fw-bold text-success"},wt={key:1,class:"d-flex justify-content-between align-items-center mb-2"},xt=a(()=>t("span",{class:"text-muted"},"折扣金額：",-1)),kt={class:"fw-bold text-success"},It=a(()=>t("hr",null,null,-1)),St={class:"d-flex justify-content-between align-items-center mb-0"},Lt=a(()=>t("span",{class:"fs-5 fw-bold"},"總計金額：",-1)),Nt={class:"fs-5 fw-bold text-danger"},Tt={class:"d-flex justify-content-between mt-4"},qt=a(()=>t("i",{class:"bi bi-arrow-left me-2"},null,-1)),At=["disabled"],Vt={key:0,class:"bi bi-arrow-clockwise spinner-icon"},jt={key:1,class:"bi bi-trash me-1"},Pt=a(()=>t("i",{class:"bi bi-arrow-right ms-2"},null,-1)),Mt={key:1,class:"text-center py-5 my-4"},Bt=a(()=>t("div",{class:"mb-4"},[t("i",{class:"bi bi-cart fs-1 text-muted"})],-1)),Rt=a(()=>t("h4",{class:"mb-3"},"購物車目前沒有任何商品",-1)),Ut=a(()=>t("p",{class:"text-muted mb-4"},"快去商城挑選您喜愛的商品吧！",-1)),Dt=a(()=>t("i",{class:"bi bi-bag me-2"},null,-1));function Ft(e,o,m,zt,l,n){const h=I("RouterLink");return c(),i("div",V,[j,e.cartStore.carts&&e.cartStore.carts.length>0?(c(),i("div",P,[t("div",M,[t("table",B,[R,t("tbody",null,[(c(!0),i(S,null,L(e.cartStore.carts,s=>(c(),i("tr",{key:s.id,class:"border-bottom"},[t("td",null,[t("div",U,[t("div",D,[t("img",{src:s.product.imageUrl,alt:s.product.title,class:"img-fluid rounded object-fit-cover",style:{width:"100%",height:"100%"}},null,8,F)]),t("div",null,[t("h6",z,d(s.product.title),1),t("small",E,d(s.product.category),1),s.coupon_code?(c(),i("div",Q," 已套用優惠券 ")):u("",!0)])])]),t("td",null,[t("div",G,[t("button",{class:"btn btn-outline-secondary",onClick:r=>n.updateQuantity(s,s.qty-1),disabled:l.loadingItem===s.id||s.qty<=1},K,8,H),g(t("input",{type:"number",class:"form-control text-center","onUpdate:modelValue":r=>s.qty=r,min:"1",max:"20",onChange:r=>n.updateCartItemLocal(s),disabled:l.loadingItem===s.id},null,40,O),[[f,s.qty,void 0,{number:!0}]]),t("button",{class:"btn btn-outline-secondary",onClick:r=>n.updateQuantity(s,s.qty+1),disabled:l.loadingItem===s.id||s.qty>=20},Y,8,W)])]),t("td",Z,[t("span",$,"NT$ "+d(n.formatPrice(s.product.price)),1),s.product.origin_price>s.product.price?(c(),i("div",tt," NT$ "+d(n.formatPrice(s.product.origin_price)),1)):u("",!0)]),t("td",st," NT$ "+d(n.formatPrice(s.total)),1),t("td",et,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:r=>n.removeCartItemLocal(s.id),disabled:l.loadingItem===s.id},[l.loadingItem===s.id?(c(),i("i",nt)):(c(),i("i",at)),ct],8,ot)])]))),128))])])]),t("div",it,[t("div",lt,[t("div",dt,[t("div",rt,[g(t("input",{type:"text",class:"form-control me-2",placeholder:"請輸入優惠碼","onUpdate:modelValue":o[0]||(o[0]=s=>l.couponCode=s),disabled:l.isApplyingCoupon},null,8,ut),[[f,l.couponCode]]),t("button",{class:"btn btn-outline-primary",style:{"min-width":"70px"},onClick:o[1]||(o[1]=(...s)=>n.applyCouponLocal&&n.applyCouponLocal(...s)),disabled:l.isApplyingCoupon||!l.couponCode},[l.isApplyingCoupon?(c(),i("i",ht)):(c(),i("span",pt,"套用"))],8,_t)]),t("div",bt,[t("div",mt,[yt,t("span",null,"NT$ "+d(n.formatPrice(e.cartStore.total)),1)]),gt,n.showCoupon?(c(),i("div",ft,[Ct,t("span",vt,d(e.cartStore.carts[0].coupon.code),1)])):u("",!0),n.showCoupon?(c(),i("div",wt,[xt,t("span",kt," -NT$ "+d(n.formatPrice(n.discountAmount)),1)])):u("",!0),It,t("div",St,[Lt,t("span",Nt," NT$ "+d(n.formatPrice(e.cartStore.final_total)),1)])])])])]),t("div",Tt,[p(h,{to:"/products",class:"btn btn-outline-secondary"},{default:b(()=>[qt,_("繼續購物 ")]),_:1}),t("div",null,[t("button",{type:"button",class:"btn btn-outline-danger me-2",onClick:o[2]||(o[2]=(...s)=>n.clearCartLocal&&n.clearCartLocal(...s)),disabled:e.cartStore.carts.length===0||l.isClearing},[l.isClearing?(c(),i("i",Vt)):(c(),i("i",jt)),_(" 清空購物車 ")],8,At),p(h,{to:"/checkout",class:N(["btn btn-danger",{disabled:e.cartStore.carts.length===0}])},{default:b(()=>[_(" 前往結帳 "),Pt]),_:1},8,["class"])])])])):(c(),i("div",Mt,[Bt,Rt,Ut,p(h,{to:"/products",class:"btn btn-primary px-4 py-2"},{default:b(()=>[Dt,_("瀏覽商品 ")]),_:1})]))])}const Ht=w(A,[["render",Ft],["__scopeId","data-v-c0660dbe"]]);export{Ht as default};
