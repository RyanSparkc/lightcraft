import{I as g,h as n}from"./index-A2IetPGn.js";import{u as c}from"./toastMessage-rb2ZDsSZ.js";var p={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"vue001",BASE_URL:"/vue_practise_w7/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_URL:d,VITE_APP_PATH:i}=p,y=g("cart",{state:()=>({carts:[],final_total:0,total:0}),actions:{getCart(){const r=c();n.get(`${d}/api/${i}/cart`).then(s=>{const{carts:a,total:e,final_total:t}=s.data.data;this.carts=a,this.total=e,a.length>0&&a[0].coupon?this.final_total=Math.round(this.total-t):this.final_total=Math.round(this.total)}).catch(s=>{var a,e;r.addMessage({title:"錯誤",content:((e=(a=s.response)==null?void 0:a.data)==null?void 0:e.message)||"載入購物車失敗",style:"danger"})})},addToCart(r,s=1){const a=c(),e={product_id:r,qty:s};n.post(`${d}/api/${i}/cart`,{data:e}).then(t=>{a.addMessage({title:"成功",content:t.data.message,style:"success"}),this.getCart()}).catch(t=>{var o,l;a.addMessage({title:"錯誤",content:((l=(o=t.response)==null?void 0:o.data)==null?void 0:l.message)||"加入購物車失敗",style:"danger"})})},async applyCoupon(r){var a,e;const s=c();try{const t=await n.post(`${d}/api/${i}/coupon`,{data:{code:r}});return s.addMessage({title:"成功",content:t.data.message,style:"success"}),this.getCart(),t}catch(t){throw s.addMessage({title:"錯誤",content:((e=(a=t.response)==null?void 0:a.data)==null?void 0:e.message)||"套用優惠券失敗",style:"danger"}),t}},async updateCartItem(r){var e,t;const s=c(),a={product_id:r.product_id,qty:r.qty};try{const o=await n.put(`${d}/api/${i}/cart/${r.id}`,{data:a});return s.addMessage({title:"成功",content:o.data.message,style:"success"}),this.getCart(),o}catch(o){throw s.addMessage({title:"錯誤",content:((t=(e=o.response)==null?void 0:e.data)==null?void 0:t.message)||"更新購物車項目失敗",style:"danger"}),o}},async removeCartItem(r){var a,e;const s=c();try{const t=await n.delete(`${d}/api/${i}/cart/${r}`);return s.addMessage({title:"成功",content:t.data.message,style:"success"}),this.getCart(),t}catch(t){throw s.addMessage({title:"錯誤",content:((e=(a=t.response)==null?void 0:a.data)==null?void 0:e.message)||"移除購物車項目失敗",style:"danger"}),t}},async clearCart(){var s,a;const r=c();try{const e=await n.delete(`${d}/api/${i}/carts`);return r.addMessage({title:"成功",content:e.data.message,style:"success"}),this.getCart(),e}catch(e){throw r.addMessage({title:"錯誤",content:((a=(s=e.response)==null?void 0:s.data)==null?void 0:a.message)||"清空購物車失敗",style:"danger"}),e}},async createOrder(r){var a,e;const s=c();try{const t=await n.post(`${d}/api/${i}/order`,{data:r});return s.addMessage({title:"成功",content:t.data.message||"訂單已成功送出",style:"success"}),this.getCart(),t.data}catch(t){throw s.addMessage({title:"錯誤",content:((e=(a=t.response)==null?void 0:a.data)==null?void 0:e.message)||"訂單送出失敗，請稍後再試",style:"danger"}),t}},async payOrder(r){var a,e;const s=c();try{const t=await n.post(`${d}/api/${i}/pay/${r}`);return s.addMessage({title:"付款成功",content:t.data.message||"付款已完成",style:"success"}),t.data}catch(t){throw s.addMessage({title:"付款失敗",content:((e=(a=t.response)==null?void 0:a.data)==null?void 0:e.message)||"付款處理失敗，請稍後再試",style:"danger"}),t}}}});export{y as u};
