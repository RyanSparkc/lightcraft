import{r as p,l as A,b as D,c as S,d as e,E as b,G as C,S as ee,t as _,k as L,o as te,a as se,e as N,V as F,f as P,F as H,q as ae,x as oe,v as U,m as O,p as le,g as de}from"./index-AP1mULAj.js";import{u as ne}from"./toastMessage-hYlk33Q3.js";import{u as ce,_ as ie,P as re}from"./DeleteModal-Bg24l3Dc.js";import{_ as ue}from"./plugin-vueexport-helper-x3n3nnut.js";const _e={class:"modal-dialog"},pe={class:"modal-content"},fe=e("div",{class:"modal-header bg-dark text-white"},[e("h1",{class:"modal-title fs-5",id:"staticBackdropLabel"},"編輯優惠券"),e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1),ve={class:"modal-body"},me={class:"mb-3"},be=e("label",{for:"coupon-name",class:"col-form-label"},"名稱",-1),he={class:"mb-3"},ge=e("label",{for:"coupon-number",class:"col-form-label"},"優惠碼",-1),xe={class:"mb-3"},ye=e("label",{for:"coupon-date",class:"col-form-label"},"到期日",-1),we={class:"mb-3"},ke=e("label",{for:"coupon-price",class:"col-form-label"},"折扣百分比",-1),$e={class:"mb-3"},Me={class:"form-check"},De=e("label",{for:"is-enabled",class:"form-check-label"},"是否啟用",-1),Se={class:"modal-footer"},Ce=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," 關閉 ",-1),Ve={__name:"CouponModal",props:{coupon:{type:Object,default:()=>({})},isNew:{type:Boolean,default:!1}},emits:["update-coupon"],setup(h,{expose:k,emit:$}){const g=h,r=$,l=p({}),u=p(""),{modalRef:f,openModal:V,closeModal:x}=ce(),y=()=>{!l.value||Object.keys(l.value).length===0||(!l.value.due_date&&u.value&&(l.value.due_date=Math.floor(new Date(u.value)/1e3)),r("update-coupon",l.value))};return A(u,n=>{n&&(l.value.due_date=Math.floor(new Date(n)/1e3))}),A(()=>g.coupon,n=>{if(n&&Object.keys(n).length>0)if(l.value={...n},n.due_date&&!Number.isNaN(n.due_date))try{const d=new Date(n.due_date*1e3);if(d instanceof Date&&!Number.isNaN(d.getTime())){const c=d.toISOString().split("T");[u.value]=c}else[u.value]=new Date().toISOString().split("T")}catch{[u.value]=new Date().toISOString().split("T")}else[u.value]=new Date().toISOString().split("T")},{immediate:!0}),k({openModal:V,closeModal:x}),(n,d)=>(D(),S("div",{class:"modal fade",id:"staticBackdrop","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"staticBackdropLabel","aria-hidden":"true",ref_key:"modalRef",ref:f},[e("div",_e,[e("div",pe,[fe,e("div",ve,[e("form",null,[e("div",me,[be,b(e("input",{type:"text",class:"form-control",id:"coupon-name","onUpdate:modelValue":d[0]||(d[0]=c=>l.value.title=c),placeholder:"請輸入標題"},null,512),[[C,l.value.title]])]),e("div",he,[ge,b(e("input",{type:"text",class:"form-control",id:"coupon-number","onUpdate:modelValue":d[1]||(d[1]=c=>l.value.code=c),placeholder:"請輸入優惠碼"},null,512),[[C,l.value.code]])]),e("div",xe,[ye,b(e("input",{type:"date",class:"form-control",id:"coupon-date","onUpdate:modelValue":d[2]||(d[2]=c=>u.value=c)},null,512),[[C,u.value]])]),e("div",we,[ke,b(e("input",{type:"number",class:"form-control",id:"coupon-price",min:"0","onUpdate:modelValue":d[3]||(d[3]=c=>l.value.percent=c)},null,512),[[C,l.value.percent,void 0,{number:!0}]])]),e("div",$e,[e("div",Me,[b(e("input",{type:"checkbox",class:"form-check-input",id:"is-enabled",min:"0","true-value":1,"false-value":0,"onUpdate:modelValue":d[4]||(d[4]=c=>l.value.is_enabled=c)},null,512),[[ee,l.value.is_enabled]]),De])])])]),e("div",Se,[Ce,e("button",{type:"button",class:"btn btn-primary",onClick:y},_(h.isNew?"新增優惠券":"更新優惠券"),1)])])])],512))}};var Te={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"vue001",BASE_URL:"/lightcraft/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const o=h=>(le("data-v-3e04c07a"),h=h(),de(),h),Ne={class:"row mb-4"},Ee={class:"col-md-3 mb-3"},Ie={class:"card border-0 shadow-sm"},Le={class:"card-body"},Pe={class:"d-flex align-items-center"},Ue={class:"flex-grow-1"},Oe=o(()=>e("p",{class:"text-muted mb-1 small"},"總優惠券數",-1)),Ae={class:"mb-0 fw-bold"},Be=o(()=>e("div",{class:"text-primary"},[e("i",{class:"fas fa-tickets-alt fa-2x"})],-1)),Re={class:"col-md-3 mb-3"},je={class:"card border-0 shadow-sm"},Fe={class:"card-body"},He={class:"d-flex align-items-center"},qe={class:"flex-grow-1"},ze=o(()=>e("p",{class:"text-muted mb-1 small"},"啟用中",-1)),Ge={class:"mb-0 fw-bold text-success"},Qe=o(()=>e("div",{class:"text-success"},[e("i",{class:"fas fa-check-circle fa-2x"})],-1)),We={class:"col-md-3 mb-3"},Je={class:"card border-0 shadow-sm"},Ke={class:"card-body"},Xe={class:"d-flex align-items-center"},Ye={class:"flex-grow-1"},Ze=o(()=>e("p",{class:"text-muted mb-1 small"},"即將到期",-1)),et={class:"mb-0 fw-bold text-warning"},tt=o(()=>e("div",{class:"text-warning"},[e("i",{class:"fas fa-exclamation-triangle fa-2x"})],-1)),st={class:"col-md-3 mb-3"},at={class:"card border-0 shadow-sm"},ot={class:"card-body"},lt={class:"d-flex align-items-center"},dt={class:"flex-grow-1"},nt=o(()=>e("p",{class:"text-muted mb-1 small"},"已過期",-1)),ct={class:"mb-0 fw-bold text-danger"},it=o(()=>e("div",{class:"text-danger"},[e("i",{class:"fas fa-times-circle fa-2x"})],-1)),rt={class:"card border-0 shadow-sm mb-4"},ut={class:"card-body"},_t={class:"row g-3"},pt={class:"col-md-4"},ft=o(()=>e("label",{class:"form-label small text-muted"},"搜尋優惠券",-1)),vt={class:"input-group"},mt=o(()=>e("span",{class:"input-group-text bg-light border-end-0"},[e("i",{class:"fas fa-search text-muted"})],-1)),bt={class:"col-md-3"},ht=o(()=>e("label",{class:"form-label small text-muted"},"啟用狀態",-1)),gt=o(()=>e("option",{value:""},"全部狀態",-1)),xt=o(()=>e("option",{value:"enabled"},"啟用中",-1)),yt=o(()=>e("option",{value:"disabled"},"已停用",-1)),wt=[gt,xt,yt],kt={class:"col-md-3"},$t=o(()=>e("label",{class:"form-label small text-muted"},"有效期限",-1)),Mt=o(()=>e("option",{value:""},"全部狀態",-1)),Dt=o(()=>e("option",{value:"valid"},"有效",-1)),St=o(()=>e("option",{value:"expiring"},"即將到期",-1)),Ct=o(()=>e("option",{value:"expired"},"已過期",-1)),Vt=[Mt,Dt,St,Ct],Tt=o(()=>e("i",{class:"fas fa-refresh me-1"},null,-1)),Nt={class:"card border-0 shadow-sm"},Et={class:"card-header bg-white border-bottom"},It={class:"d-flex justify-content-between align-items-center"},Lt=o(()=>e("h5",{class:"mb-0 fw-semibold"},"優惠券列表",-1)),Pt={class:"d-flex align-items-center gap-3"},Ut={class:"badge bg-light text-dark"},Ot=o(()=>e("i",{class:"fas fa-plus me-1"},null,-1)),At={class:"card-body p-0"},Bt={class:"table-responsive"},Rt={class:"table table-hover align-middle mb-0"},jt=o(()=>e("thead",{class:"bg-light"},[e("tr",null,[e("th",{class:"border-0 ps-4"},"優惠券名稱"),e("th",{class:"border-0"},"優惠券代碼"),e("th",{class:"border-0"},"折扣"),e("th",{class:"border-0"},"到期日"),e("th",{class:"border-0"},"狀態"),e("th",{class:"border-0 pe-4"},"操作")])],-1)),Ft={class:"ps-4"},Ht={class:"d-flex align-items-center"},qt=o(()=>e("div",{class:"avatar-sm rounded-circle bg-info bg-opacity-10 me-2 d-flex align-items-center justify-content-center"},[e("i",{class:"fas fa-ticket-alt text-info"})],-1)),zt={class:"text-dark fw-medium"},Gt={class:"bg-light text-dark px-2 py-1 rounded small"},Qt={class:"fw-bold text-success fs-5"},Wt=o(()=>e("small",{class:"text-muted d-block"},"折扣",-1)),Jt={class:"text-dark fw-medium"},Kt={class:"pe-4"},Xt={class:"btn-group"},Yt=["onClick"],Zt=o(()=>e("i",{class:"fas fa-edit"},null,-1)),es=[Zt],ts=["onClick"],ss=o(()=>e("i",{class:"fas fa-trash"},null,-1)),as=[ss],os={key:0,class:"text-center py-5"},ls=o(()=>e("i",{class:"fas fa-ticket-alt fa-3x text-muted mb-3"},null,-1)),ds=o(()=>e("h5",{class:"text-muted"},"沒有找到符合條件的優惠券",-1)),ns=o(()=>e("p",{class:"text-muted"},"請調整搜尋條件或建立新的優惠券",-1)),cs=[ls,ds,ns],is={__name:"CouponView",setup(h){const{VITE_APP_URL:k,VITE_APP_PATH:$}=Te,g=ne(),r=p(!1),l=p(!1),u=p({}),f=p({title:"",is_enabled:0,percent:100,code:""}),V=p(""),x=p(""),y=p(""),n=p(""),d=p(null),c=p(null),q=t=>new Date(t*1e3).toLocaleDateString("zh-TW"),m=t=>{const s=new Date;return new Date(t*1e3)<s},M=t=>{const s=new Date,i=new Date(t*1e3),a=Math.ceil((i-s)/(1e3*60*60*24));return a<=7&&a>0},z=t=>m(t)?"text-danger":M(t)?"text-warning":"text-success",G=t=>{const s=new Date,i=new Date(t*1e3),a=Math.ceil((i-s)/(1e3*60*60*24));return a<0?`已過期 ${Math.abs(a)} 天`:a===0?"今天到期":a<=7?`${a} 天後到期`:"有效期限內"},Q=t=>t.is_enabled?m(t.due_date)?"badge bg-danger":M(t.due_date)?"badge bg-warning text-dark":"badge bg-success":"badge bg-secondary",W=t=>t.is_enabled?m(t.due_date)?"fas fa-times me-1":M(t.due_date)?"fas fa-exclamation-triangle me-1":"fas fa-check me-1":"fas fa-pause me-1",J=t=>t.is_enabled?m(t.due_date)?"已過期":M(t.due_date)?"即將到期":"啟用中":"已停用",B=L(()=>Object.values(u.value||{})),E=L(()=>{let t=B.value;if(x.value){const s=x.value.toLowerCase();t=t.filter(i=>i.title.toLowerCase().includes(s)||i.code.toLowerCase().includes(s))}return y.value==="enabled"?t=t.filter(s=>s.is_enabled):y.value==="disabled"&&(t=t.filter(s=>!s.is_enabled)),n.value==="valid"?t=t.filter(s=>!m(s.due_date)):n.value==="expiring"?t=t.filter(s=>M(s.due_date)):n.value==="expired"&&(t=t.filter(s=>m(s.due_date))),t}),T=L(()=>{const t=B.value,s=t.length,i=t.filter(v=>v.is_enabled&&!m(v.due_date)).length,a=t.filter(v=>M(v.due_date)).length,w=t.filter(v=>m(v.due_date)).length;return{total:s,active:i,expiringSoon:a,expired:w}});A(V,()=>{f.value.due_date=Math.floor(new Date(V.value)/1e3)});const I=()=>{r.value=!0,U.get(`${k}/api/${$}/admin/coupons`).then(t=>{u.value=t.data.coupons,r.value=!1}).catch(t=>{r.value=!1,g.addMessage({title:"錯誤",content:t.response.data.message,style:"danger"})})},R=(t,s)=>{l.value=t,l.value?f.value={title:"",code:"",percent:0,is_enabled:1,due_date:Math.floor(new Date().getTime()/1e3)}:f.value={...s},d.value.openModal()},K=t=>{f.value={...t},c.value.openModal()},X=t=>{r.value=!0;let s=`${k}/api/${$}/admin/coupon`,i="post",a={...t};l.value||(s=`${k}/api/${$}/admin/coupon/${t.id}`,i="put",a={...t}),U[i](s,{data:a}).then(w=>{r.value=!1,g.addMessage({title:l.value?"新增優惠券":"更新優惠券",content:w.data.message,style:"success"}),I(),d.value.closeModal()}).catch(w=>{var v,j;r.value=!1,g.addMessage({title:"錯誤",content:((j=(v=w.response)==null?void 0:v.data)==null?void 0:j.message)||"操作失敗",style:"danger"})})},Y=()=>{r.value=!0;const t=`${k}/api/${$}/admin/coupon/${f.value.id}`;U.delete(t).then(s=>{r.value=!1,g.addMessage({title:"刪除優惠券",content:s.data.message,style:"success"}),I(),c.value.closeModal()}).catch(s=>{r.value=!1,g.addMessage({title:"錯誤",content:s.response.data.message,style:"danger"})})},Z=()=>{x.value="",y.value="",n.value=""};return te(()=>{I()}),(t,s)=>{const i=se("LoadingOverlay");return D(),S(H,null,[N(i,{active:r.value},null,8,["active"]),N(re,{icon:"fas fa-ticket-alt","icon-color":"text-info",title:"優惠券管理",subtitle:"管理促銷優惠券，設定折扣與使用期限"}),e("div",Ne,[e("div",Ee,[e("div",Ie,[e("div",Le,[e("div",Pe,[e("div",Ue,[Oe,e("h4",Ae,_(T.value.total),1)]),Be])])])]),e("div",Re,[e("div",je,[e("div",Fe,[e("div",He,[e("div",qe,[ze,e("h4",Ge,_(T.value.active),1)]),Qe])])])]),e("div",We,[e("div",Je,[e("div",Ke,[e("div",Xe,[e("div",Ye,[Ze,e("h4",et,_(T.value.expiringSoon),1)]),tt])])])]),e("div",st,[e("div",at,[e("div",ot,[e("div",lt,[e("div",dt,[nt,e("h4",ct,_(T.value.expired),1)]),it])])])])]),e("div",rt,[e("div",ut,[e("div",_t,[e("div",pt,[ft,e("div",vt,[mt,b(e("input",{type:"text",class:"form-control border-start-0",placeholder:"搜尋優惠券名稱或代碼...","onUpdate:modelValue":s[0]||(s[0]=a=>x.value=a)},null,512),[[C,x.value]])])]),e("div",bt,[ht,b(e("select",{class:"form-select","onUpdate:modelValue":s[1]||(s[1]=a=>y.value=a)},wt,512),[[F,y.value]])]),e("div",kt,[$t,b(e("select",{class:"form-select","onUpdate:modelValue":s[2]||(s[2]=a=>n.value=a)},Vt,512),[[F,n.value]])]),e("div",{class:"col-md-2 d-flex align-items-end"},[e("button",{class:"btn btn-outline-secondary w-100",onClick:Z},[Tt,P(" 清除 ")])])])])]),e("div",Nt,[e("div",Et,[e("div",It,[Lt,e("div",Pt,[e("span",Ut,"共 "+_(E.value.length)+" 張優惠券",1),e("button",{class:"btn btn-primary btn-sm",type:"button",onClick:s[3]||(s[3]=a=>R(!0))},[Ot,P(" 建立新優惠券 ")])])])]),e("div",At,[e("div",Bt,[e("table",Rt,[jt,e("tbody",null,[(D(!0),S(H,null,ae(E.value,a=>(D(),S("tr",{key:a.id,class:"border-bottom"},[e("td",Ft,[e("div",Ht,[qt,e("div",null,[e("div",zt,_(a.title),1)])])]),e("td",null,[e("code",Gt,_(a.code),1)]),e("td",null,[e("span",Qt,_(a.percent)+"%",1),Wt]),e("td",null,[e("div",Jt,_(q(a.due_date)),1),e("small",{class:O(z(a.due_date))},_(G(a.due_date)),3)]),e("td",null,[e("span",{class:O(Q(a))},[e("i",{class:O(W(a))},null,2),P(" "+_(J(a)),1)],2)]),e("td",Kt,[e("div",Xt,[e("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:w=>R(!1,a),title:"編輯優惠券"},es,8,Yt),e("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:w=>K(a),title:"刪除優惠券"},as,8,ts)])])]))),128))])]),E.value.length===0?(D(),S("div",os,cs)):oe("",!0)])])]),N(Ve,{coupon:f.value,isNew:l.value,ref_key:"couponModal",ref:d,onUpdateCoupon:X},null,8,["coupon","isNew"]),N(ie,{ref_key:"delModal",ref:c,item:f.value,onConfirm:Y},null,8,["item"])],64)}}},fs=ue(is,[["__scopeId","data-v-3e04c07a"]]);export{fs as default};
