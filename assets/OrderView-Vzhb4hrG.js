import{_ as w,o as n,c,b as t,t as a,j as k,F as v,i as M,C as b,O as C,a as L,r as u,d as m,D as x,P as S,e as O,n as p,p as T,f as F}from"./index-UKIsyGAy.js";import{u as A}from"./toastMessage-WJ0KJshq.js";import{m as V,P as I}from"./modalMixin-ohY_RE5h.js";import{D as N}from"./DelModal-M9s3Engh.js";import"./bootstrap.esm-UN3Qh_Ru.js";const E={props:{order:{type:Object,default(){return{}}}},data(){return{status:{},modal:"",tempOrder:{},isPaid:!1}},emits:["update-paid"],mixins:[V],watch:{order(){this.tempOrder=this.order}}},U={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},j={class:"modal-dialog modal-xl",role:"document"},Q={class:"modal-content border-0"},H=t("div",{class:"modal-header bg-dark text-white"},[t("h5",{class:"modal-title",id:"exampleModalLabel"},[t("span",null,"訂單細節")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),R={class:"modal-body"},B={class:"row"},q={class:"col-md-4"},z=t("h3",null,"用戶資料",-1),W={class:"table"},G={key:0},J=t("th",{style:{width:"100px"}},"姓名",-1),K=t("th",null,"Email",-1),X=t("th",null,"電話",-1),Y=t("th",null,"地址",-1),Z={class:"col-md-8"},tt=t("h3",null,"訂單細節",-1),et={class:"table"},st=t("th",{style:{width:"100px"}},"訂單編號",-1),ot=t("th",null,"下單時間",-1),dt=t("th",null,"付款時間",-1),lt={key:0},at={key:1},it=t("th",null,"付款狀態",-1),rt={key:0,class:"text-success"},nt={key:1,class:"text-muted"},ct=t("th",null,"總金額",-1),_t=t("h3",null,"選購商品",-1),ht={class:"table"},ut=t("thead",null,[t("tr")],-1),mt={class:"text-end"},pt={class:"d-flex justify-content-end"},bt={class:"form-check"},ft={class:"form-check-label",for:"flexCheckDefault"},gt={key:0},vt={key:1},yt={class:"modal-footer"},xt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Ot(e,s,r,h,o,d){return n(),c("div",U,[t("div",j,[t("div",Q,[H,t("div",R,[t("div",B,[t("div",q,[z,t("table",W,[o.tempOrder.user?(n(),c("tbody",G,[t("tr",null,[J,t("td",null,a(o.tempOrder.user.name),1)]),t("tr",null,[K,t("td",null,a(o.tempOrder.user.email),1)]),t("tr",null,[X,t("td",null,a(o.tempOrder.user.tel),1)]),t("tr",null,[Y,t("td",null,a(o.tempOrder.user.address),1)])])):k("",!0)])]),t("div",Z,[tt,t("table",et,[t("tbody",null,[t("tr",null,[st,t("td",null,a(o.tempOrder.id),1)]),t("tr",null,[ot,t("td",null,a(e.$filters.date(o.tempOrder.create_at)),1)]),t("tr",null,[dt,t("td",null,[o.tempOrder.paid_date?(n(),c("span",lt,a(e.$filters.date(o.tempOrder.paid_date)),1)):(n(),c("span",at,"時間不正確"))])]),t("tr",null,[it,t("td",null,[o.tempOrder.is_paid?(n(),c("strong",rt,"已付款")):(n(),c("span",nt,"尚未付款"))])]),t("tr",null,[ct,t("td",null,a(e.$filters.currency(o.tempOrder.total)),1)])])]),_t,t("table",ht,[ut,t("tbody",null,[(n(!0),c(v,null,M(o.tempOrder.products,_=>(n(),c("tr",{key:_.id},[t("th",null,a(_.product.title),1),t("td",null,a(_.qty)+" / "+a(_.product.unit),1),t("td",mt,a(),1)]))),128))])]),t("div",pt,[t("div",bt,[b(t("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":s[0]||(s[0]=_=>o.tempOrder.is_paid=_)},null,512),[[C,o.tempOrder.is_paid]]),t("label",ft,[o.tempOrder.is_paid?(n(),c("span",gt,"已付款")):(n(),c("span",vt,"未付款"))])])])])])]),t("div",yt,[xt,t("button",{type:"button",class:"btn btn-primary",onClick:s[1]||(s[1]=_=>e.$emit("update-paid",o.tempOrder))}," 修改付款狀態 ")])])])],512)}const wt=w(E,[["render",Ot]]);var kt={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"vue001",BASE_URL:"/lightcraft/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_URL:f,VITE_APP_PATH:g}=kt,Mt={data(){return{orders:{},currentPage:1,isLoading:!0,tempOrder:{},isNew:!1,searchQuery:"",paymentFilter:"",dateFilter:""}},components:{PageHeader:I,OrderModal:wt,DelModal:N},computed:{ordersArray(){return Object.values(this.orders||{})},filteredOrders(){let e=this.ordersArray;if(this.searchQuery){const s=this.searchQuery.toLowerCase();e=e.filter(r=>r.user.email.toLowerCase().includes(s)||r.id.toLowerCase().includes(s))}if(this.paymentFilter==="paid"?e=e.filter(s=>s.is_paid):this.paymentFilter==="unpaid"&&(e=e.filter(s=>!s.is_paid)),this.dateFilter){const s=new Date(this.dateFilter);e=e.filter(r=>new Date(r.create_at*1e3).toDateString()===s.toDateString())}return e},orderStats(){const e=this.ordersArray,s=e.length,r=e.filter(d=>d.is_paid).length,h=s-r,o=e.reduce((d,_)=>d+this.calculateCorrectTotal(_),0);return{total:s,paid:r,unpaid:h,totalAmount:o}}},methods:{...L(A,["addMessage"]),calculateCorrectTotal(e){if(!e.products)return Number(e.total||0);const s=Object.values(e.products);if(s.some(h=>h.coupon)){const h=s.reduce((d,_)=>d+Number(_.total||0),0),o=Number(e.total||0);return h-o}return Number(e.total||0)},getOrders(e=1){this.currentPage=e;const s=`${f}/api/${g}/admin/orders?page=${e}`;this.axios.get(s).then(r=>{this.orders=r.data.orders}).catch(r=>{this.addMessage({title:"錯誤",content:r.response.data.message,style:"danger"})}).finally(()=>{this.isLoading=!1})},openModal(e){this.tempOrder={...e},this.isNew=!1,this.$refs.orderModal.openModal()},openDelModal(e){this.tempOrder={...e},this.$refs.delModal.openModal()},togglePaymentStatus(e){const s={...e,is_paid:!e.is_paid};this.updatePaid(s)},updatePaid(e){this.isLoading=!0;const s=`${f}/api/${g}/admin/order/${e.id}`,r={is_paid:e.is_paid};this.axios.put(s,{data:r}).then(h=>{this.$refs.orderModal.closeModal(),this.getOrders(this.currentPage),this.addMessage({title:"更新成功",content:h.data.message,style:"success"})}).catch(h=>{this.addMessage({title:"錯誤",content:h.response.data.message,style:"danger"})}).finally(()=>{this.isLoading=!1})},deleteOrder(){this.isLoading=!0;const e=`${f}/api/${g}/admin/order/${this.tempOrder.id}`;this.axios.delete(e).then(s=>{this.$refs.delModal.closeModal(),this.getOrders(this.currentPage),this.addMessage({title:"刪除成功",content:s.data.message,style:"success"})}).catch(s=>{this.addMessage({title:"錯誤",content:s.response.data.message,style:"danger"})}).finally(()=>{this.isLoading=!1})},clearFilters(){this.searchQuery="",this.paymentFilter="",this.dateFilter=""},formatDate(e){return new Date(e*1e3).toLocaleDateString()},formatTime(e){return new Date(e*1e3).toLocaleTimeString("zh-TW",{hour:"2-digit",minute:"2-digit"})}},mounted(){this.getOrders()}},i=e=>(T("data-v-a7653496"),e=e(),F(),e),Dt={class:"row mb-4"},$t={class:"col-md-3 mb-3"},Pt={class:"card border-0 shadow-sm"},Ct={class:"card-body"},Lt={class:"d-flex align-items-center"},St={class:"flex-grow-1"},Tt=i(()=>t("p",{class:"text-muted mb-1 small"},"總訂單數",-1)),Ft={class:"mb-0 fw-bold"},At=i(()=>t("div",{class:"text-primary"},[t("i",{class:"fas fa-list-alt fa-2x"})],-1)),Vt={class:"col-md-3 mb-3"},It={class:"card border-0 shadow-sm"},Nt={class:"card-body"},Et={class:"d-flex align-items-center"},Ut={class:"flex-grow-1"},jt=i(()=>t("p",{class:"text-muted mb-1 small"},"已付款",-1)),Qt={class:"mb-0 fw-bold text-success"},Ht=i(()=>t("div",{class:"text-success"},[t("i",{class:"fas fa-check-circle fa-2x"})],-1)),Rt={class:"col-md-3 mb-3"},Bt={class:"card border-0 shadow-sm"},qt={class:"card-body"},zt={class:"d-flex align-items-center"},Wt={class:"flex-grow-1"},Gt=i(()=>t("p",{class:"text-muted mb-1 small"},"未付款",-1)),Jt={class:"mb-0 fw-bold text-warning"},Kt=i(()=>t("div",{class:"text-warning"},[t("i",{class:"fas fa-clock fa-2x"})],-1)),Xt={class:"col-md-3 mb-3"},Yt={class:"card border-0 shadow-sm"},Zt={class:"card-body"},te={class:"d-flex align-items-center"},ee={class:"flex-grow-1"},se=i(()=>t("p",{class:"text-muted mb-1 small"},"總金額",-1)),oe={class:"mb-0 fw-bold text-info"},de=i(()=>t("div",{class:"text-info"},[t("i",{class:"fas fa-dollar-sign fa-2x"})],-1)),le={class:"card border-0 shadow-sm mb-4"},ae={class:"card-body"},ie={class:"row g-3"},re={class:"col-md-4"},ne=i(()=>t("label",{class:"form-label small text-muted"},"搜尋訂單",-1)),ce={class:"input-group"},_e=i(()=>t("span",{class:"input-group-text bg-light border-end-0"},[t("i",{class:"fas fa-search text-muted"})],-1)),he={class:"col-md-3"},ue=i(()=>t("label",{class:"form-label small text-muted"},"付款狀態",-1)),me=i(()=>t("option",{value:""},"全部狀態",-1)),pe=i(()=>t("option",{value:"paid"},"已付款",-1)),be=i(()=>t("option",{value:"unpaid"},"未付款",-1)),fe=[me,pe,be],ge={class:"col-md-3"},ve=i(()=>t("label",{class:"form-label small text-muted"},"日期篩選",-1)),ye={class:"col-md-2 d-flex align-items-end"},xe=i(()=>t("i",{class:"fas fa-refresh me-1"},null,-1)),Oe={class:"card border-0 shadow-sm"},we={class:"card-header bg-white border-bottom"},ke={class:"d-flex justify-content-between align-items-center"},Me=i(()=>t("h5",{class:"mb-0 fw-semibold"},"訂單列表",-1)),De={class:"badge bg-light text-dark"},$e={class:"card-body p-0"},Pe={class:"table-responsive"},Ce={class:"table table-hover align-middle mb-0"},Le=i(()=>t("thead",{class:"bg-light"},[t("tr",null,[t("th",{class:"border-0 ps-4"},"日期"),t("th",{class:"border-0"},"客戶信箱"),t("th",{class:"border-0"},"訂單編號"),t("th",{class:"border-0"},"總金額"),t("th",{class:"border-0"},"付款狀態"),t("th",{class:"border-0"},"備註"),t("th",{class:"border-0 pe-4"},"操作")])],-1)),Se={class:"ps-4"},Te={class:"text-dark fw-medium"},Fe={class:"text-muted"},Ae={class:"d-flex align-items-center"},Ve=i(()=>t("div",{class:"avatar-sm rounded-circle bg-primary bg-opacity-10 me-2 d-flex align-items-center justify-content-center"},[t("i",{class:"fas fa-user text-primary"})],-1)),Ie={class:"text-dark"},Ne={class:"bg-light text-dark px-2 py-1 rounded small"},Ee={class:"fw-semibold text-success"},Ue={class:"text-muted small"},je={class:"pe-4"},Qe={class:"btn-group"},He=["onClick"],Re=i(()=>t("i",{class:"fas fa-eye"},null,-1)),Be=[Re],qe=["onClick","title"],ze=["onClick"],We=i(()=>t("i",{class:"fas fa-trash"},null,-1)),Ge=[We],Je={key:0,class:"text-center py-5"},Ke=i(()=>t("i",{class:"fas fa-inbox fa-3x text-muted mb-3"},null,-1)),Xe=i(()=>t("h5",{class:"text-muted"},"沒有找到符合條件的訂單",-1)),Ye=i(()=>t("p",{class:"text-muted"},"請調整搜尋條件或清除篩選器",-1)),Ze=[Ke,Xe,Ye];function ts(e,s,r,h,o,d){const _=u("LoadingOverlay"),D=u("PageHeader"),$=u("OrderModal"),P=u("DelModal");return n(),c(v,null,[m(_,{active:o.isLoading},null,8,["active"]),m(D,{icon:"fas fa-shopping-cart","icon-color":"text-primary",title:"訂單管理",subtitle:"管理所有客戶訂單與付款狀態"}),t("div",Dt,[t("div",$t,[t("div",Pt,[t("div",Ct,[t("div",Lt,[t("div",St,[Tt,t("h4",Ft,a(d.orderStats.total),1)]),At])])])]),t("div",Vt,[t("div",It,[t("div",Nt,[t("div",Et,[t("div",Ut,[jt,t("h4",Qt,a(d.orderStats.paid),1)]),Ht])])])]),t("div",Rt,[t("div",Bt,[t("div",qt,[t("div",zt,[t("div",Wt,[Gt,t("h4",Jt,a(d.orderStats.unpaid),1)]),Kt])])])]),t("div",Xt,[t("div",Yt,[t("div",Zt,[t("div",te,[t("div",ee,[se,t("h4",oe," NT$ "+a(d.orderStats.totalAmount.toLocaleString()),1)]),de])])])])]),t("div",le,[t("div",ae,[t("div",ie,[t("div",re,[ne,t("div",ce,[_e,b(t("input",{type:"text",class:"form-control border-start-0",placeholder:"搜尋 Email 或訂單編號...","onUpdate:modelValue":s[0]||(s[0]=l=>o.searchQuery=l)},null,512),[[x,o.searchQuery]])])]),t("div",he,[ue,b(t("select",{class:"form-select","onUpdate:modelValue":s[1]||(s[1]=l=>o.paymentFilter=l)},fe,512),[[S,o.paymentFilter]])]),t("div",ge,[ve,b(t("input",{type:"date",class:"form-control","onUpdate:modelValue":s[2]||(s[2]=l=>o.dateFilter=l)},null,512),[[x,o.dateFilter]])]),t("div",ye,[t("button",{class:"btn btn-outline-secondary w-100",onClick:s[3]||(s[3]=(...l)=>d.clearFilters&&d.clearFilters(...l))},[xe,O(" 清除 ")])])])])]),t("div",Oe,[t("div",we,[t("div",ke,[Me,t("span",De,"共 "+a(d.filteredOrders.length)+" 筆訂單",1)])]),t("div",$e,[t("div",Pe,[t("table",Ce,[Le,t("tbody",null,[(n(!0),c(v,null,M(d.filteredOrders,l=>(n(),c("tr",{key:l.id,class:"border-bottom"},[t("td",Se,[t("div",Te,a(d.formatDate(l.create_at)),1),t("small",Fe,a(d.formatTime(l.create_at)),1)]),t("td",null,[t("div",Ae,[Ve,t("div",null,[t("div",Ie,a(l.user.email),1)])])]),t("td",null,[t("code",Ne,a(l.id),1)]),t("td",null,[t("span",Ee,"NT$ "+a(d.calculateCorrectTotal(l).toLocaleString()),1)]),t("td",null,[t("span",{class:p(l.is_paid?"badge bg-success":"badge bg-warning text-dark")},[t("i",{class:p(l.is_paid?"fas fa-check me-1":"fas fa-clock me-1")},null,2),O(" "+a(l.is_paid?"已付款":"未付款"),1)],2)]),t("td",null,[t("span",Ue,a(l.message||"-"),1)]),t("td",je,[t("div",Qe,[t("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:y=>d.openModal(l),title:"檢視詳細"},Be,8,He),t("button",{class:p(l.is_paid?"btn btn-outline-warning btn-sm":"btn btn-outline-success btn-sm"),type:"button",onClick:y=>d.togglePaymentStatus(l),title:l.is_paid?"標記為未付款":"標記為已付款"},[t("i",{class:p(l.is_paid?"fas fa-times":"fas fa-check")},null,2)],10,qe),t("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:y=>d.openDelModal(l),title:"刪除訂單"},Ge,8,ze)])])]))),128))])]),d.filteredOrders.length===0?(n(),c("div",Je,Ze)):k("",!0)])])]),m($,{ref:"orderModal",order:o.tempOrder,onUpdatePaid:d.updatePaid},null,8,["order","onUpdatePaid"]),m(P,{ref:"delModal",item:o.tempOrder,onDelItem:d.deleteOrder},null,8,["item","onDelItem"])],64)}const as=w(Mt,[["render",ts],["__scopeId","data-v-a7653496"]]);export{as as default};
