import{s as A,r as x,k as S,o as D,a as E,b as a,c,u as l,d as t,F,q as z,E as V,G as j,t as r,x as k,e as f,w as g,f as u,m as L,p as G,g as P}from"./index-AP1mULAj.js";import{u as H}from"./cartStore-VmWaVlR-.js";import{u as J}from"./toastMessage-hYlk33Q3.js";import{_ as K}from"./plugin-vueexport-helper-x3n3nnut.js";const e=w=>(G("data-v-42accf1e"),w=w(),P(),w),O={class:"container my-5"},W=e(()=>t("h2",{class:"section-title mb-4"},"購物車",-1)),X={key:0},Y={class:"table-responsive"},Z={class:"table align-middle"},Q=e(()=>t("thead",{class:"bg-light"},[t("tr",null,[t("th",{class:"py-3"},"商品資訊"),t("th",{class:"py-3 text-center",style:{width:"180px"}},"數量"),t("th",{class:"py-3 text-end"},"單價"),t("th",{class:"py-3 text-end"},"小計"),t("th",{class:"py-3 text-center"},"操作")])],-1)),tt={class:"d-flex align-items-center"},st={class:"me-3",style:{width:"80px",height:"80px"}},et=["src","alt"],ot={class:"mb-1"},at={class:"text-muted"},ct={key:0,class:"badge bg-success mt-1"},nt={class:"quantity-selector-wrapper d-flex justify-content-center"},lt={class:"quantity-selector d-flex"},it=["onClick","disabled"],dt=e(()=>t("i",{class:"bi bi-dash"},null,-1)),rt=[dt],_t=["onUpdate:modelValue","onChange","disabled"],ut=["onClick","disabled"],ht=e(()=>t("i",{class:"bi bi-plus"},null,-1)),bt=[ht],pt={class:"text-end"},yt={class:"fw-medium"},vt={key:0,class:"text-muted text-decoration-line-through small"},mt={class:"text-end fw-bold"},ft={class:"text-center"},gt=["onClick","disabled"],wt={key:0,class:"bi bi-arrow-clockwise spinner-icon"},xt={key:1,class:"bi bi-trash"},kt=e(()=>t("span",{class:"ms-1 d-none d-sm-inline"},"刪除",-1)),Ct={class:"card mt-4 border-0 shadow-sm"},qt={class:"card-body p-4"},Tt={class:"row"},Nt={class:"col-md-6 d-flex align-items-center mb-md-0 mb-3"},$t=["disabled"],It=["disabled"],St={key:0,class:"bi bi-arrow-clockwise spinner-icon"},Vt={key:1},jt={class:"col-md-6"},Lt={class:"d-flex justify-content-between align-items-center mb-2"},Mt=e(()=>t("span",{class:"text-muted"},"商品小計：",-1)),Bt=e(()=>t("div",{class:"d-flex justify-content-between align-items-center mb-2"},[t("span",{class:"text-muted"},"運費："),t("span",null,"NT$ 0")],-1)),Ut={key:0,class:"d-flex justify-content-between align-items-center mb-2"},Rt=e(()=>t("span",{class:"text-muted"},"已套用優惠券：",-1)),At={class:"fw-bold text-success"},Dt={key:1,class:"d-flex justify-content-between align-items-center mb-2"},Et=e(()=>t("span",{class:"text-muted"},"折扣金額：",-1)),Ft={class:"fw-bold text-success"},zt=e(()=>t("hr",null,null,-1)),Gt={class:"d-flex justify-content-between align-items-center mb-0"},Pt=e(()=>t("span",{class:"fs-5 fw-bold"},"總計金額：",-1)),Ht={class:"fs-5 fw-bold text-danger"},Jt={class:"cart-actions mt-4"},Kt={class:"d-md-flex justify-content-between align-items-center"},Ot=e(()=>t("i",{class:"bi bi-arrow-left me-2"},null,-1)),Wt=["disabled"],Xt={key:0,class:"bi bi-arrow-clockwise spinner-icon"},Yt={key:1,class:"bi bi-trash me-1"},Zt=e(()=>t("i",{class:"bi bi-arrow-right ms-2"},null,-1)),Qt={class:"d-md-none"},ts={class:"row g-2 mb-2"},ss={class:"col-6"},es=e(()=>t("i",{class:"bi bi-arrow-left me-2"},null,-1)),os={class:"col-6"},as=e(()=>t("i",{class:"bi bi-arrow-right ms-2"},null,-1)),cs={class:"row"},ns={class:"col-12"},ls=["disabled"],is={key:0,class:"bi bi-arrow-clockwise spinner-icon"},ds={key:1,class:"bi bi-trash me-1"},rs={key:1,class:"text-center py-5 my-4"},_s=e(()=>t("div",{class:"mb-4"},[t("i",{class:"bi bi-cart fs-1 text-muted"})],-1)),us=e(()=>t("h4",{class:"mb-3"},"購物車目前沒有任何商品",-1)),hs=e(()=>t("p",{class:"text-muted mb-4"},"快去商城挑選您喜愛的商品吧！",-1)),bs=e(()=>t("i",{class:"bi bi-bag me-2"},null,-1)),ps={__name:"CartView",setup(w){const h=H(),M=J(),{carts:i,total:C,final_total:q}=A(h),d=x(""),b=x(!1),p=x(""),v=x(!1),T=S(()=>{var o,n;return!!((n=(o=i.value)==null?void 0:o[0])!=null&&n.coupon)}),B=S(()=>{const o=C.value-q.value;return Math.round(o)}),y=o=>o.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),N=async o=>{d.value=o.id;try{await h.updateCartItem(o)}catch{}finally{d.value=""}},$=(o,n)=>{if(n>=1&&n<=20){const _={...o,qty:n};N(_)}},U=async o=>{d.value=o;try{await h.removeCartItem(o)}catch{}finally{d.value=""}},I=async()=>{b.value=!0;try{await h.clearCart()}catch{}finally{b.value=!1}},R=async()=>{if(!p.value){M.addMessage({title:"提示",content:"請輸入優惠碼",style:"warning"});return}v.value=!0;try{await h.applyCoupon(p.value),p.value=""}catch{}finally{v.value=!1}};return D(()=>{h.getCart()}),(o,n)=>{const _=E("RouterLink");return a(),c("div",O,[W,l(i)&&l(i).length>0?(a(),c("div",X,[t("div",Y,[t("table",Z,[Q,t("tbody",null,[(a(!0),c(F,null,z(l(i),s=>(a(),c("tr",{key:s.id,class:"border-bottom"},[t("td",null,[t("div",tt,[t("div",st,[t("img",{src:s.product.imageUrl,alt:s.product.title,class:"img-fluid rounded object-fit-cover",style:{width:"100%",height:"100%"}},null,8,et)]),t("div",null,[t("h6",ot,r(s.product.title),1),t("small",at,r(s.product.category),1),s.coupon_code?(a(),c("div",ct," 已套用優惠券 ")):k("",!0)])])]),t("td",null,[t("div",nt,[t("div",lt,[t("button",{class:"qty-btn qty-btn-minus",onClick:m=>$(s,s.qty-1),disabled:d.value===s.id||s.qty<=1},rt,8,it),V(t("input",{type:"number",class:"qty-input text-center","onUpdate:modelValue":m=>s.qty=m,min:"1",max:"20",onChange:m=>N(s),disabled:d.value===s.id},null,40,_t),[[j,s.qty,void 0,{number:!0}]]),t("button",{class:"qty-btn qty-btn-plus",onClick:m=>$(s,s.qty+1),disabled:d.value===s.id||s.qty>=20},bt,8,ut)])])]),t("td",pt,[t("span",yt,"NT$ "+r(y(s.product.price)),1),s.product.origin_price>s.product.price?(a(),c("div",vt," NT$ "+r(y(s.product.origin_price)),1)):k("",!0)]),t("td",mt," NT$ "+r(y(s.total)),1),t("td",ft,[t("button",{type:"button",class:"btn-danger-outline",onClick:m=>U(s.id),disabled:d.value===s.id},[d.value===s.id?(a(),c("i",wt)):(a(),c("i",xt)),kt],8,gt)])]))),128))])])]),t("div",Ct,[t("div",qt,[t("div",Tt,[t("div",Nt,[V(t("input",{type:"text",class:"form-control coupon-input me-2",placeholder:"請輸入優惠碼","onUpdate:modelValue":n[0]||(n[0]=s=>p.value=s),disabled:v.value},null,8,$t),[[j,p.value]]),t("button",{class:"btn-apply",onClick:R,disabled:v.value||!p.value},[v.value?(a(),c("i",St)):(a(),c("span",Vt,"套用"))],8,It)]),t("div",jt,[t("div",Lt,[Mt,t("span",null,"NT$ "+r(y(l(C))),1)]),Bt,T.value?(a(),c("div",Ut,[Rt,t("span",At,r(l(i)[0].coupon.code),1)])):k("",!0),T.value?(a(),c("div",Dt,[Et,t("span",Ft," 折扣 NT$ "+r(y(B.value)),1)])):k("",!0),zt,t("div",Gt,[Pt,t("span",Ht," NT$ "+r(y(l(q))),1)])])])])]),t("div",Jt,[t("div",Kt,[f(_,{to:"/products",class:"btn-secondary"},{default:g(()=>[Ot,u("繼續購物 ")]),_:1}),t("button",{type:"button",class:"btn-danger-outline",onClick:I,disabled:l(i).length===0||b.value},[b.value?(a(),c("i",Xt)):(a(),c("i",Yt)),u(" 清空購物車 ")],8,Wt),f(_,{to:"/checkout/address",class:L(["btn-primary",{disabled:l(i).length===0}])},{default:g(()=>[u(" 前往結帳 "),Zt]),_:1},8,["class"])]),t("div",Qt,[t("div",ts,[t("div",ss,[f(_,{to:"/products",class:"btn-secondary w-100"},{default:g(()=>[es,u("繼續購物 ")]),_:1})]),t("div",os,[f(_,{to:"/checkout/address",class:L(["btn-primary w-100",{disabled:l(i).length===0}])},{default:g(()=>[u(" 前往結帳 "),as]),_:1},8,["class"])])]),t("div",cs,[t("div",ns,[t("button",{type:"button",class:"btn-danger-outline w-100",onClick:I,disabled:l(i).length===0||b.value},[b.value?(a(),c("i",is)):(a(),c("i",ds)),u(" 清空購物車 ")],8,ls)])])])])])):(a(),c("div",rs,[_s,us,hs,f(_,{to:"/products",class:"btn-primary"},{default:g(()=>[bs,u("瀏覽商品 ")]),_:1})]))])}}},gs=K(ps,[["__scopeId","data-v-42accf1e"]]);export{gs as default};
