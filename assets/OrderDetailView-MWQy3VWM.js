import{_ as P,h as w,o as a,c as n,b as t,e as x,t as r,n as k,j as l,F as T,i as D,g as N,p as S,f as z}from"./index-UKIsyGAy.js";var L={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"vue001",BASE_URL:"/lightcraft/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const O={name:"OrderDetailView",data(){return{order:{},isLoading:!1,paymentMethods:{credit_card:"信用卡",credit:"信用卡",atm:"ATM 轉帳",transfer:"銀行轉帳",bank_transfer:"銀行轉帳"}}},computed:{hasOrderData(){return this.order&&this.order.id},orderProducts(){return this.order.products?Object.values(this.order.products):[]},subtotal(){return this.orderProducts.length?this.orderProducts.reduce((s,c)=>{var e;const _=Number((e=c.product)==null?void 0:e.price)||0,h=Number(c.qty)||0;return s+_*h},0):0},finalTotal(){return this.orderProducts.length?this.orderProducts.reduce((s,c)=>{const _=Number(c.final_total)||0;return s+_},0):0},discountAmount(){const s=this.subtotal-this.finalTotal;return s>0?s:0},hasDiscount(){return this.discountAmount>0}},methods:{async getOrder(s){var h;if(!s){console.error("訂單 ID 無效");return}const{VITE_APP_URL:c,VITE_APP_PATH:_}=L;this.isLoading=!0;try{const e=`${c}/api/${_}/order/${s}`,i=await w.get(e);this.order=i.data.order}catch(e){console.error("獲取訂單失敗",e),((h=e.response)==null?void 0:h.status)===404&&(this.order=null)}finally{this.isLoading=!1}},formatDate(s){return s?new Date(s*1e3).toLocaleString("zh-TW",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"無資料"},formatPrice(s){const c=Number(s);return!c||Number.isNaN(c)?"0":Math.round(c).toLocaleString()},getShippingStatus(s){return s.is_paid?"備貨中":"待付款"},getPaymentMethod(s){return s!=null&&s.payment_method?this.paymentMethods[s.payment_method]||"其他方式":"未設定"},goToPayment(){const s={carts:this.orderProducts.map(c=>({id:c.id,product:c.product,qty:c.qty})),total:this.subtotal,final_total:this.finalTotal};localStorage.setItem("orderCartData",JSON.stringify(s)),this.$router.push({path:"/checkout/payment",query:{orderId:this.order.id}})}},created(){const s=this.$route.params.id;s&&this.getOrder(s)}},o=s=>(S("data-v-091958c0"),s=s(),z(),s),A={class:"order-detail-container container my-5"},I={class:"mb-4"},V=o(()=>t("i",{class:"bi bi-arrow-left me-2"},null,-1)),j={key:0,class:"card mb-4"},E={class:"card-body"},C={class:"d-flex justify-content-between align-items-center mb-3"},M={class:"card-title mb-0"},q={class:"row mt-3"},R={class:"col-md-6"},B=o(()=>t("p",{class:"text-muted mb-1"},"訂單日期",-1)),U={class:"mb-3"},F={class:"col-md-6"},H=o(()=>t("p",{class:"text-muted mb-1"},"付款日期",-1)),W={class:"mb-3"},J={class:"col-md-6"},G=o(()=>t("p",{class:"text-muted mb-1"},"配送狀態",-1)),K={class:"mb-3"},Q={class:"badge bg-secondary"},X={class:"col-md-6"},Y=o(()=>t("p",{class:"text-muted mb-1"},"付款方式",-1)),Z={class:"mb-3"},$={key:0,class:"mt-3 pt-3 border-top"},tt={class:"d-flex justify-content-end"},st=o(()=>t("i",{class:"bi bi-credit-card me-2"},null,-1)),et={key:1,class:"card mb-4"},ot=o(()=>t("div",{class:"card-header bg-white border-bottom-0 py-3"},[t("h5",{class:"mb-0"},"配送追蹤")],-1)),it={class:"card-body"},ct=o(()=>t("div",{class:"mb-3"},[t("p",{class:"text-muted mb-1"},"物流單號"),t("p",{class:"mb-0 fw-medium"},"TW123456789")],-1)),rt={class:"tracking-timeline-horizontal"},dt={class:"tracking-item-horizontal active"},at=o(()=>t("div",{class:"tracking-icon-horizontal"},[t("i",{class:"bi bi-check-circle-fill"})],-1)),nt={class:"tracking-content-horizontal"},lt=o(()=>t("p",{class:"tracking-title"},"訂單已確認",-1)),_t={class:"tracking-date"},ht=o(()=>t("div",{class:"tracking-icon-horizontal"},[t("i",{class:"bi bi-credit-card"})],-1)),ut={class:"tracking-content-horizontal"},mt=o(()=>t("p",{class:"tracking-title"},"付款完成",-1)),bt={class:"tracking-date"},pt=N('<div class="tracking-item-horizontal" data-v-091958c0><div class="tracking-icon-horizontal" data-v-091958c0><i class="bi bi-box-seam" data-v-091958c0></i></div><div class="tracking-content-horizontal" data-v-091958c0><p class="tracking-title" data-v-091958c0>商品已出貨</p><p class="tracking-date" data-v-091958c0>待處理</p></div></div><div class="tracking-item-horizontal" data-v-091958c0><div class="tracking-icon-horizontal" data-v-091958c0><i class="bi bi-house-door" data-v-091958c0></i></div><div class="tracking-content-horizontal" data-v-091958c0><p class="tracking-title" data-v-091958c0>商品已送達</p><p class="tracking-date" data-v-091958c0>待處理</p></div></div>',2),vt={key:2,class:"row"},gt={class:"col-lg-8 mb-4"},ft={class:"card h-100"},yt=o(()=>t("div",{class:"card-header bg-white border-bottom-0 py-3"},[t("h5",{class:"mb-0"},"訂單商品")],-1)),xt={class:"card-body"},kt={class:"table-responsive"},Pt={class:"table mb-0"},wt=o(()=>t("thead",{class:"table-light"},[t("tr",null,[t("th",{class:"border-0"},"商品"),t("th",{class:"border-0 text-center"},"單價"),t("th",{class:"border-0 text-center"},"數量"),t("th",{class:"border-0 text-end"},"小計")])],-1)),Tt={class:"d-flex align-items-center"},Dt=["src"],Nt={class:"mb-0"},St={class:"text-muted"},zt={class:"text-center align-middle"},Lt={class:"text-center align-middle"},Ot={class:"text-end align-middle"},At={class:"col-lg-4"},It={class:"card mb-4"},Vt=o(()=>t("div",{class:"card-header bg-white border-bottom-0 py-3"},[t("h5",{class:"mb-0"},"收件人資訊")],-1)),jt={class:"card-body"},Et={class:"mb-3"},Ct=o(()=>t("p",{class:"text-muted mb-1"},"姓名",-1)),Mt={class:"mb-0 fw-medium"},qt={class:"mb-3"},Rt=o(()=>t("p",{class:"text-muted mb-1"},"電話",-1)),Bt={class:"mb-0 fw-medium"},Ut={class:"mb-3"},Ft=o(()=>t("p",{class:"text-muted mb-1"},"Email",-1)),Ht={class:"mb-0 fw-medium"},Wt=o(()=>t("p",{class:"text-muted mb-1"},"地址",-1)),Jt={class:"mb-0 fw-medium"},Gt={class:"card"},Kt=o(()=>t("div",{class:"card-header bg-white border-bottom-0 py-3"},[t("h5",{class:"mb-0"},"金額摘要")],-1)),Qt={class:"card-body"},Xt={class:"d-flex justify-content-between mb-2"},Yt=o(()=>t("span",null,"商品總額",-1)),Zt=o(()=>t("div",{class:"d-flex justify-content-between mb-2"},[t("span",null,"運費"),t("span",null,"NT$ 0")],-1)),$t={key:0,class:"d-flex justify-content-between mb-3"},ts=o(()=>t("span",null,"優惠折扣",-1)),ss={class:"text-danger"},es=o(()=>t("hr",null,null,-1)),os={class:"d-flex justify-content-between"},is=o(()=>t("span",{class:"fw-bold"},"總計",-1)),cs={class:"fw-bold"},rs={key:3,class:"text-center py-5"},ds=o(()=>t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")],-1)),as=o(()=>t("p",{class:"mt-3"},"正在獲取訂單資料...",-1)),ns=[ds,as],ls={key:4,class:"text-center py-5"},_s=o(()=>t("h4",null,"找不到訂單資料",-1)),hs=o(()=>t("p",{class:"text-muted"},"請確認訂單號碼是否正確",-1));function us(s,c,_,h,e,i){var u,m,b,p;return a(),n("div",A,[t("div",I,[t("button",{class:"btn btn-outline-secondary",onClick:c[0]||(c[0]=d=>s.$router.go(-1))},[V,x("返回 ")])]),i.hasOrderData?(a(),n("div",j,[t("div",E,[t("div",C,[t("h4",M,"訂單 #"+r(e.order.id||"123456"),1),t("span",{class:k(["order-status px-3 py-1 rounded-pill flex-shrink-0",{"bg-success text-white":e.order.is_paid,"bg-warning":!e.order.is_paid}])},r(e.order.is_paid?"已付款":"待付款"),3)]),t("div",q,[t("div",R,[B,t("p",U,r(i.formatDate(e.order.create_at)),1)]),t("div",F,[H,t("p",W,r(e.order.paid_date?i.formatDate(e.order.paid_date):"尚未付款"),1)]),t("div",J,[G,t("p",K,[t("span",Q,r(i.getShippingStatus(e.order)),1)])]),t("div",X,[Y,t("p",Z,r(i.getPaymentMethod(e.order)),1)])]),e.order.is_paid?l("",!0):(a(),n("div",$,[t("div",tt,[t("button",{class:"btn btn-primary btn-lg px-4",onClick:c[1]||(c[1]=(...d)=>i.goToPayment&&i.goToPayment(...d))},[st,x(" 前往付款 ")])])]))])])):l("",!0),i.hasOrderData?(a(),n("div",et,[ot,t("div",it,[ct,t("div",rt,[t("div",dt,[at,t("div",nt,[lt,t("p",_t,r(i.formatDate(e.order.create_at)),1)])]),t("div",{class:k(["tracking-item-horizontal",{active:e.order.is_paid}])},[ht,t("div",ut,[mt,t("p",bt,r(e.order.paid_date?i.formatDate(e.order.paid_date):"待處理"),1)])],2),pt])])])):l("",!0),i.hasOrderData?(a(),n("div",vt,[t("div",gt,[t("div",ft,[yt,t("div",xt,[t("div",kt,[t("table",Pt,[wt,t("tbody",null,[(a(!0),n(T,null,D(i.orderProducts,d=>{var v,g,f,y;return a(),n("tr",{key:d.id},[t("td",null,[t("div",Tt,[t("img",{src:(v=d.product)==null?void 0:v.imageUrl,class:"img-fluid me-3",style:{width:"60px",height:"60px","object-fit":"cover"},alt:"商品圖片"},null,8,Dt),t("div",null,[t("h6",Nt,r((g=d.product)==null?void 0:g.title),1),t("small",St,r((f=d.product)==null?void 0:f.category),1)])])]),t("td",zt," NT$ "+r(i.formatPrice((y=d.product)==null?void 0:y.price)),1),t("td",Lt,r(d.qty),1),t("td",Ot," NT$ "+r(i.formatPrice(d.final_total)),1)])}),128))])])])])])]),t("div",At,[t("div",It,[Vt,t("div",jt,[t("div",Et,[Ct,t("p",Mt,r((u=e.order.user)==null?void 0:u.name),1)]),t("div",qt,[Rt,t("p",Bt,r((m=e.order.user)==null?void 0:m.tel),1)]),t("div",Ut,[Ft,t("p",Ht,r((b=e.order.user)==null?void 0:b.email),1)]),t("div",null,[Wt,t("p",Jt,r((p=e.order.user)==null?void 0:p.address),1)])])]),t("div",Gt,[Kt,t("div",Qt,[t("div",Xt,[Yt,t("span",null,"NT$ "+r(i.formatPrice(i.subtotal)),1)]),Zt,i.hasDiscount?(a(),n("div",$t,[ts,t("span",ss,"-NT$ "+r(i.formatPrice(i.finalTotal)),1)])):l("",!0),es,t("div",os,[is,t("span",cs,"NT$ "+r(i.formatPrice(i.discountAmount)),1)])])])])])):l("",!0),e.isLoading?(a(),n("div",rs,ns)):l("",!0),!e.isLoading&&(!e.order||!e.order.id)?(a(),n("div",ls,[_s,hs,t("button",{class:"btn btn-primary mt-3",onClick:c[2]||(c[2]=d=>s.$router.push("/"))}," 返回首頁 ")])):l("",!0)])}const bs=P(O,[["render",us],["__scopeId","data-v-091958c0"]]);export{bs as default};
