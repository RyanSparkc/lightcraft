import{r as u,l as X,b as i,c as r,d as t,t as d,x as z,F as B,q as Q,E as N,S as Y,Q as Z,U as tt,k as R,o as st,a as et,e as E,G as q,V as ot,f as H,v as F,m as I,p as at,g as lt}from"./index-AP1mULAj.js";import{u as dt}from"./toastMessage-hYlk33Q3.js";import{u as nt,_ as ct,P as it}from"./DeleteModal-Bg24l3Dc.js";import{_ as rt}from"./plugin-vueexport-helper-x3n3nnut.js";const _t={class:"modal-dialog modal-xl",role:"document"},ut={class:"modal-content border-0"},ht=t("div",{class:"modal-header bg-dark text-white"},[t("h5",{class:"modal-title",id:"exampleModalLabel"},[t("span",null,"訂單細節")]),t("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1),mt={class:"modal-body"},pt={class:"row"},vt={class:"col-md-4"},bt=t("h3",null,"用戶資料",-1),ft={class:"table"},gt={key:0},yt=t("th",{style:{width:"100px"}},"姓名",-1),xt=t("th",null,"Email",-1),$t=t("th",null,"電話",-1),wt=t("th",null,"地址",-1),kt={class:"col-md-8"},Mt=t("h3",null,"訂單細節",-1),Ct={class:"table"},Dt=t("th",{style:{width:"100px"}},"訂單編號",-1),St=t("th",null,"下單時間",-1),Tt=t("th",null,"付款時間",-1),Lt={key:0},Pt={key:1},Vt=t("th",null,"付款狀態",-1),Ot={key:0,class:"text-success"},At={key:1,class:"text-muted"},Et=t("th",null,"總金額",-1),It=t("h3",null,"選購商品",-1),Nt={class:"table"},Ut=t("thead",null,[t("tr")],-1),jt=t("td",{class:"text-end"},null,-1),Rt={class:"d-flex justify-content-end"},Ft={class:"form-check"},Bt={class:"form-check-label",for:"flexCheckDefault"},qt={key:0},Ht={key:1},zt={class:"modal-footer"},Qt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1),Gt={__name:"OrderModal",props:{order:{type:Object,default:()=>({})}},emits:["update-paid"],setup(y,{expose:w,emit:k}){const L=y,M=k,{modalRef:h,openModal:b,closeModal:U}=nt(),l=u({}),m=c=>c?Z(c):"",f=c=>c?tt(c):"";return X(()=>L.order,c=>{c&&Object.keys(c).length>0&&(l.value={...c})},{immediate:!0,deep:!0}),w({openModal:b,closeModal:U}),(c,p)=>{var P,v,C,V,O,D,x,g;return i(),r("div",{class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref_key:"modalRef",ref:h},[t("div",_t,[t("div",ut,[ht,t("div",mt,[t("div",pt,[t("div",vt,[bt,t("table",ft,[(P=l.value)!=null&&P.user?(i(),r("tbody",gt,[t("tr",null,[yt,t("td",null,d(l.value.user.name),1)]),t("tr",null,[xt,t("td",null,d(l.value.user.email),1)]),t("tr",null,[$t,t("td",null,d(l.value.user.tel),1)]),t("tr",null,[wt,t("td",null,d(l.value.user.address),1)])])):z("",!0)])]),t("div",kt,[Mt,t("table",Ct,[t("tbody",null,[t("tr",null,[Dt,t("td",null,d((v=l.value)==null?void 0:v.id),1)]),t("tr",null,[St,t("td",null,d(m((C=l.value)==null?void 0:C.create_at)),1)]),t("tr",null,[Tt,t("td",null,[(V=l.value)!=null&&V.paid_date?(i(),r("span",Lt,d(m(l.value.paid_date)),1)):(i(),r("span",Pt,"時間不正確"))])]),t("tr",null,[Vt,t("td",null,[(O=l.value)!=null&&O.is_paid?(i(),r("strong",Ot,"已付款")):(i(),r("span",At,"尚未付款"))])]),t("tr",null,[Et,t("td",null,d(f((D=l.value)==null?void 0:D.total)),1)])])]),It,t("table",Nt,[Ut,t("tbody",null,[(i(!0),r(B,null,Q(((x=l.value)==null?void 0:x.products)||[],_=>{var S,A;return i(),r("tr",{key:_.id},[t("th",null,d((S=_.product)==null?void 0:S.title),1),t("td",null,d(_.qty)+" / "+d((A=_.product)==null?void 0:A.unit),1),jt])}),128))])]),t("div",Rt,[t("div",Ft,[N(t("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":p[0]||(p[0]=_=>l.value.is_paid=_)},null,512),[[Y,l.value.is_paid]]),t("label",Bt,[(g=l.value)!=null&&g.is_paid?(i(),r("span",qt,"已付款")):(i(),r("span",Ht,"未付款"))])])])])])]),t("div",zt,[Qt,t("button",{type:"button",class:"btn btn-primary",onClick:p[1]||(p[1]=_=>M("update-paid",l.value))}," 修改付款狀態 ")])])])],512)}}};var Wt={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"vue001",BASE_URL:"/lightcraft/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const a=y=>(at("data-v-de7ae60d"),y=y(),lt(),y),Jt={class:"row mb-4"},Kt={class:"col-md-3 mb-3"},Xt={class:"card border-0 shadow-sm"},Yt={class:"card-body"},Zt={class:"d-flex align-items-center"},ts={class:"flex-grow-1"},ss=a(()=>t("p",{class:"text-muted mb-1 small"},"總訂單數",-1)),es={class:"mb-0 fw-bold"},os=a(()=>t("div",{class:"text-primary"},[t("i",{class:"fas fa-list-alt fa-2x"})],-1)),as={class:"col-md-3 mb-3"},ls={class:"card border-0 shadow-sm"},ds={class:"card-body"},ns={class:"d-flex align-items-center"},cs={class:"flex-grow-1"},is=a(()=>t("p",{class:"text-muted mb-1 small"},"已付款",-1)),rs={class:"mb-0 fw-bold text-success"},_s=a(()=>t("div",{class:"text-success"},[t("i",{class:"fas fa-check-circle fa-2x"})],-1)),us={class:"col-md-3 mb-3"},hs={class:"card border-0 shadow-sm"},ms={class:"card-body"},ps={class:"d-flex align-items-center"},vs={class:"flex-grow-1"},bs=a(()=>t("p",{class:"text-muted mb-1 small"},"未付款",-1)),fs={class:"mb-0 fw-bold text-warning"},gs=a(()=>t("div",{class:"text-warning"},[t("i",{class:"fas fa-clock fa-2x"})],-1)),ys={class:"col-md-3 mb-3"},xs={class:"card border-0 shadow-sm"},$s={class:"card-body"},ws={class:"d-flex align-items-center"},ks={class:"flex-grow-1"},Ms=a(()=>t("p",{class:"text-muted mb-1 small"},"總金額",-1)),Cs={class:"mb-0 fw-bold text-info"},Ds=a(()=>t("div",{class:"text-info"},[t("i",{class:"fas fa-dollar-sign fa-2x"})],-1)),Ss={class:"card border-0 shadow-sm mb-4"},Ts={class:"card-body"},Ls={class:"row g-3"},Ps={class:"col-md-4"},Vs=a(()=>t("label",{class:"form-label small text-muted"},"搜尋訂單",-1)),Os={class:"input-group"},As=a(()=>t("span",{class:"input-group-text bg-light border-end-0"},[t("i",{class:"fas fa-search text-muted"})],-1)),Es={class:"col-md-3"},Is=a(()=>t("label",{class:"form-label small text-muted"},"付款狀態",-1)),Ns=a(()=>t("option",{value:""},"全部狀態",-1)),Us=a(()=>t("option",{value:"paid"},"已付款",-1)),js=a(()=>t("option",{value:"unpaid"},"未付款",-1)),Rs=[Ns,Us,js],Fs={class:"col-md-3"},Bs=a(()=>t("label",{class:"form-label small text-muted"},"日期篩選",-1)),qs=a(()=>t("i",{class:"fas fa-refresh me-1"},null,-1)),Hs={class:"card border-0 shadow-sm"},zs={class:"card-header bg-white border-bottom"},Qs={class:"d-flex justify-content-between align-items-center"},Gs=a(()=>t("h5",{class:"mb-0 fw-semibold"},"訂單列表",-1)),Ws={class:"badge bg-light text-dark"},Js={class:"card-body p-0"},Ks={class:"table-responsive"},Xs={class:"table table-hover align-middle mb-0"},Ys=a(()=>t("thead",{class:"bg-light"},[t("tr",null,[t("th",{class:"border-0 ps-4"},"日期"),t("th",{class:"border-0"},"客戶信箱"),t("th",{class:"border-0"},"訂單編號"),t("th",{class:"border-0"},"總金額"),t("th",{class:"border-0"},"付款狀態"),t("th",{class:"border-0"},"備註"),t("th",{class:"border-0 pe-4"},"操作")])],-1)),Zs={class:"ps-4"},te={class:"text-dark fw-medium"},se={class:"text-muted"},ee={class:"d-flex align-items-center"},oe=a(()=>t("div",{class:"avatar-sm rounded-circle bg-primary bg-opacity-10 me-2 d-flex align-items-center justify-content-center"},[t("i",{class:"fas fa-user text-primary"})],-1)),ae={class:"text-dark"},le={class:"bg-light text-dark px-2 py-1 rounded small"},de={class:"fw-semibold text-success"},ne={class:"text-muted small"},ce={class:"pe-4"},ie={class:"btn-group"},re=["onClick"],_e=a(()=>t("i",{class:"fas fa-eye"},null,-1)),ue=[_e],he=["onClick","title"],me=["onClick"],pe=a(()=>t("i",{class:"fas fa-trash"},null,-1)),ve=[pe],be={key:0,class:"text-center py-5"},fe=a(()=>t("i",{class:"fas fa-inbox fa-3x text-muted mb-3"},null,-1)),ge=a(()=>t("h5",{class:"text-muted"},"沒有找到符合條件的訂單",-1)),ye=a(()=>t("p",{class:"text-muted"},"請調整搜尋條件或清除篩選器",-1)),xe=[fe,ge,ye],$e={__name:"OrderView",setup(y){const{VITE_APP_URL:w,VITE_APP_PATH:k}=Wt,L=u({}),M=u(1),h=u(!0),b=u({}),U=u(!1),l=u(""),m=u(""),f=u(""),c=u(null),p=u(null),P=dt(),{addMessage:v}=P,C=s=>{if(!s.products)return Number(s.total||0);const e=Object.values(s.products);if(e.some(o=>o.coupon)){const o=e.reduce((T,j)=>T+Number(j.total||0),0),$=Number(s.total||0);return o-$}return Number(s.total||0)},V=s=>new Date(s*1e3).toLocaleDateString(),O=s=>new Date(s*1e3).toLocaleTimeString("zh-TW",{hour:"2-digit",minute:"2-digit"}),D=R(()=>Object.values(L.value||{})),x=R(()=>{let s=D.value;if(l.value){const e=l.value.toLowerCase();s=s.filter(n=>n.user.email.toLowerCase().includes(e)||n.id.toLowerCase().includes(e))}if(m.value==="paid"?s=s.filter(e=>e.is_paid):m.value==="unpaid"&&(s=s.filter(e=>!e.is_paid)),f.value){const e=new Date(f.value);s=s.filter(n=>new Date(n.create_at*1e3).toDateString()===e.toDateString())}return s}),g=R(()=>{const s=D.value,e=s.length,n=s.filter(T=>T.is_paid).length,o=e-n,$=s.reduce((T,j)=>T+C(j),0);return{total:e,paid:n,unpaid:o,totalAmount:$}}),_=async(s=1)=>{M.value=s;const e=`${w}/api/${k}/admin/orders?page=${s}`;try{const n=await F.get(e);L.value=n.data.orders}catch(n){v({title:"錯誤",content:n.response.data.message,style:"danger"})}finally{h.value=!1}},S=async s=>{h.value=!0;const e=`${w}/api/${k}/admin/order/${s.id}`,n={is_paid:s.is_paid};try{const o=await F.put(e,{data:n});c.value.closeModal(),_(M.value),v({title:"更新成功",content:o.data.message,style:"success"})}catch(o){v({title:"錯誤",content:o.response.data.message,style:"danger"})}finally{h.value=!1}},A=async()=>{h.value=!0;const s=`${w}/api/${k}/admin/order/${b.value.id}`;try{const e=await F.delete(s);p.value.closeModal(),_(M.value),v({title:"刪除成功",content:e.data.message,style:"success"})}catch(e){v({title:"錯誤",content:e.response.data.message,style:"danger"})}finally{h.value=!1}},G=s=>{b.value={...s},U.value=!1,c.value.openModal()},W=s=>{b.value={...s},p.value.openModal()},J=s=>{const e={...s,is_paid:!s.is_paid};S(e)},K=()=>{l.value="",m.value="",f.value=""};return st(()=>{_()}),(s,e)=>{const n=et("LoadingOverlay");return i(),r(B,null,[E(n,{active:h.value},null,8,["active"]),E(it,{icon:"fas fa-shopping-cart","icon-color":"text-primary",title:"訂單管理",subtitle:"管理所有客戶訂單與付款狀態"}),t("div",Jt,[t("div",Kt,[t("div",Xt,[t("div",Yt,[t("div",Zt,[t("div",ts,[ss,t("h4",es,d(g.value.total),1)]),os])])])]),t("div",as,[t("div",ls,[t("div",ds,[t("div",ns,[t("div",cs,[is,t("h4",rs,d(g.value.paid),1)]),_s])])])]),t("div",us,[t("div",hs,[t("div",ms,[t("div",ps,[t("div",vs,[bs,t("h4",fs,d(g.value.unpaid),1)]),gs])])])]),t("div",ys,[t("div",xs,[t("div",$s,[t("div",ws,[t("div",ks,[Ms,t("h4",Cs," NT$ "+d(g.value.totalAmount.toLocaleString()),1)]),Ds])])])])]),t("div",Ss,[t("div",Ts,[t("div",Ls,[t("div",Ps,[Vs,t("div",Os,[As,N(t("input",{type:"text",class:"form-control border-start-0",placeholder:"搜尋 Email 或訂單編號...","onUpdate:modelValue":e[0]||(e[0]=o=>l.value=o)},null,512),[[q,l.value]])])]),t("div",Es,[Is,N(t("select",{class:"form-select","onUpdate:modelValue":e[1]||(e[1]=o=>m.value=o)},Rs,512),[[ot,m.value]])]),t("div",Fs,[Bs,N(t("input",{type:"date",class:"form-control","onUpdate:modelValue":e[2]||(e[2]=o=>f.value=o)},null,512),[[q,f.value]])]),t("div",{class:"col-md-2 d-flex align-items-end"},[t("button",{class:"btn btn-outline-secondary w-100",onClick:K},[qs,H(" 清除 ")])])])])]),t("div",Hs,[t("div",zs,[t("div",Qs,[Gs,t("span",Ws,"共 "+d(x.value.length)+" 筆訂單",1)])]),t("div",Js,[t("div",Ks,[t("table",Xs,[Ys,t("tbody",null,[(i(!0),r(B,null,Q(x.value,o=>(i(),r("tr",{key:o.id,class:"border-bottom"},[t("td",Zs,[t("div",te,d(V(o.create_at)),1),t("small",se,d(O(o.create_at)),1)]),t("td",null,[t("div",ee,[oe,t("div",null,[t("div",ae,d(o.user.email),1)])])]),t("td",null,[t("code",le,d(o.id),1)]),t("td",null,[t("span",de,"NT$ "+d(C(o).toLocaleString()),1)]),t("td",null,[t("span",{class:I(o.is_paid?"badge bg-success":"badge bg-warning text-dark")},[t("i",{class:I(o.is_paid?"fas fa-check me-1":"fas fa-clock me-1")},null,2),H(" "+d(o.is_paid?"已付款":"未付款"),1)],2)]),t("td",null,[t("span",ne,d(o.message||"-"),1)]),t("td",ce,[t("div",ie,[t("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:$=>G(o),title:"檢視詳細"},ue,8,re),t("button",{class:I(o.is_paid?"btn btn-outline-warning btn-sm":"btn btn-outline-success btn-sm"),type:"button",onClick:$=>J(o),title:o.is_paid?"標記為未付款":"標記為已付款"},[t("i",{class:I(o.is_paid?"fas fa-times":"fas fa-check")},null,2)],10,he),t("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:$=>W(o),title:"刪除訂單"},ve,8,me)])])]))),128))])]),x.value.length===0?(i(),r("div",be,xe)):z("",!0)])])]),E(Gt,{ref_key:"orderModal",ref:c,order:b.value,onUpdatePaid:S},null,8,["order"]),E(ct,{ref_key:"delModal",ref:p,item:b.value,onConfirm:A},null,8,["item"])],64)}}},De=rt($e,[["__scopeId","data-v-de7ae60d"]]);export{De as default};
