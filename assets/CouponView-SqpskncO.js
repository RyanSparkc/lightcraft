import{_ as w,o as h,c as m,b as e,C as u,D as f,O as E,t as r,a as L,r as b,d as g,P as y,e as x,F as C,i as T,j as F,n as v,p as V,f as P}from"./index-UKIsyGAy.js";import{u as I}from"./toastMessage-WJ0KJshq.js";import{m as A,P as N}from"./modalMixin-ohY_RE5h.js";import{D as U}from"./DelModal-M9s3Engh.js";import"./bootstrap.esm-UN3Qh_Ru.js";const B={props:{coupon:Object,isNew:Boolean},data(){return{tempCoupon:{},due_date:""}},emits:["update-coupon"],watch:{due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)},coupon(){this.tempCoupon=this.coupon;const t=new Date(this.tempCoupon.due_date*1e3).toISOString().split("T");[this.due_date]=t}},mixins:[A]},$={class:"modal fade",id:"staticBackdrop","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"staticBackdropLabel","aria-hidden":"true",ref:"modal"},O={class:"modal-dialog"},Q={class:"modal-content"},j=e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"staticBackdropLabel"},"編輯優惠券"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),H={class:"modal-body"},R={class:"mb-3"},z=e("label",{for:"coupon-name",class:"col-form-label"},"名稱",-1),q={class:"mb-3"},W=e("label",{for:"coupon-number",class:"col-form-label"},"優惠碼",-1),G={class:"mb-3"},J=e("label",{for:"coupon-date",class:"col-form-label"},"到期日",-1),K={class:"mb-3"},X=e("label",{for:"coupon-price",class:"col-form-label"},"折扣百分比",-1),Y={class:"mb-3"},Z={class:"form-check"},ee=e("label",{for:"is-enabled",class:"form-check-label"},"是否啟用",-1),te={class:"modal-footer"},se=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"關閉",-1);function oe(t,s,d,l,a,i){return h(),m("div",$,[e("div",O,[e("div",Q,[j,e("div",H,[e("form",null,[e("div",R,[z,u(e("input",{type:"text",class:"form-control",id:"coupon-name","onUpdate:modelValue":s[0]||(s[0]=c=>a.tempCoupon.title=c),placeholder:"請輸入標題"},null,512),[[f,a.tempCoupon.title]])]),e("div",q,[W,u(e("input",{type:"text",class:"form-control",id:"coupon-number","onUpdate:modelValue":s[1]||(s[1]=c=>a.tempCoupon.code=c),placeholder:"請輸入優惠碼"},null,512),[[f,a.tempCoupon.code]])]),e("div",G,[J,u(e("input",{type:"date",class:"form-control",id:"coupon-date","onUpdate:modelValue":s[2]||(s[2]=c=>a.due_date=c)},null,512),[[f,a.due_date]])]),e("div",K,[X,u(e("input",{type:"number",class:"form-control",id:"coupon-price",min:"0","onUpdate:modelValue":s[3]||(s[3]=c=>a.tempCoupon.percent=c)},null,512),[[f,a.tempCoupon.percent,void 0,{number:!0}]])]),e("div",Y,[e("div",Z,[u(e("input",{type:"checkbox",class:"form-check-input",id:"is-enabled",min:"0","true-value":1,"false-value":0,"onUpdate:modelValue":s[4]||(s[4]=c=>a.tempCoupon.is_enabled=c)},null,512),[[E,a.tempCoupon.is_enabled]]),ee])])])]),e("div",te,[se,e("button",{type:"button",class:"btn btn-primary",onClick:s[5]||(s[5]=c=>t.$emit("update-coupon",a.tempCoupon))},r(d.isNew?"新增優惠券":"更新優惠券"),1)])])])],512)}const ae=w(B,[["render",oe]]);var ie={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"vue001",BASE_URL:"/lightcraft/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_URL:p,VITE_APP_PATH:_}=ie,ne={components:{PageHeader:N,DelModal:U,CouponModal:ae},data(){return{isLoading:!1,isNew:!1,coupons:{},tempCoupon:{title:"",is_enabled:0,percent:100,code:""},due_date:"",modal:"",searchQuery:"",statusFilter:"",expiryFilter:""}},computed:{couponsArray(){return Object.values(this.coupons||{})},filteredCoupons(){let t=this.couponsArray;if(this.searchQuery){const s=this.searchQuery.toLowerCase();t=t.filter(d=>d.title.toLowerCase().includes(s)||d.code.toLowerCase().includes(s))}return this.statusFilter==="enabled"?t=t.filter(s=>s.is_enabled):this.statusFilter==="disabled"&&(t=t.filter(s=>!s.is_enabled)),this.expiryFilter==="valid"?t=t.filter(s=>!this.isExpired(s.due_date)):this.expiryFilter==="expiring"?t=t.filter(s=>this.isExpiringSoon(s.due_date)):this.expiryFilter==="expired"&&(t=t.filter(s=>this.isExpired(s.due_date))),t},couponStats(){const t=this.couponsArray,s=t.length,d=t.filter(i=>i.is_enabled&&!this.isExpired(i.due_date)).length,l=t.filter(i=>this.isExpiringSoon(i.due_date)).length,a=t.filter(i=>this.isExpired(i.due_date)).length;return{total:s,active:d,expiringSoon:l,expired:a}}},watch:{due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}},methods:{...L(I,["addMessage"]),getCoupons(){this.isLoading=!0,this.axios.get(`${p}/api/${_}/admin/coupons`).then(t=>{this.coupons=t.data.coupons,this.isLoading=!1}).catch(t=>{this.isLoading=!1,this.addMessage({title:"錯誤",content:t.response.data.message,style:"danger"})})},openCouponModal(t,s){if(this.isNew=t,this.isNew)this.tempCoupon={due_date:new Date().getTime()/1e3};else{this.tempCoupon={...s};const d=new Date(this.tempCoupon.due_date*1e3).toISOString().split("T");[this.due_date]=d}this.$refs.couponModal.openModal()},openDelCouponModal(t){this.tempCoupon={...t},this.$refs.delModal.openModal()},toggleCouponStatus(t){const s={...t,is_enabled:!t.is_enabled};this.updateCouponStatus(s)},updateCouponStatus(t){this.isLoading=!0;const s=`${p}/api/${_}/admin/coupon/${t.id}`,d={is_enabled:t.is_enabled};this.axios.put(s,{data:d}).then(l=>{this.isLoading=!1,this.addMessage({title:"更新成功",content:l.data.message,style:"success"}),this.getCoupons()}).catch(l=>{this.isLoading=!1,this.addMessage({title:"錯誤",content:l.response.data.message,style:"danger"})})},updateCoupon(t){this.isLoading=!0;let s=`${p}/api/${_}/admin/coupon`,d="post",l={...t};this.isNew||(s=`${p}/api/${_}/admin/coupon/${t.id}`,d="put",l=this.tempCoupon),this.axios[d](s,{data:l}).then(a=>{this.isLoading=!1,this.addMessage({title:"新增優惠券",content:a.data.message,style:"success"}),this.getCoupons(),this.$refs.couponModal.closeModal()}).catch(a=>{this.isLoading=!1,this.addMessage({title:"錯誤",content:a.response.data.message,style:"danger"})})},deleteCoupon(){this.isLoading=!0;const t=`${p}/api/${_}/admin/coupon/${this.tempCoupon.id}`;this.axios.delete(t).then(s=>{this.isLoading=!1,this.addMessage({title:"刪除優惠券",content:s.data.message,style:"success"}),this.getCoupons(),this.$refs.delModal.closeModal()}).catch(s=>{this.isLoading=!1,this.addMessage({title:"錯誤",content:s.response.data.message,style:"danger"})})},clearFilters(){this.searchQuery="",this.statusFilter="",this.expiryFilter=""},formatDate(t){return new Date(t*1e3).toLocaleDateString("zh-TW")},isExpired(t){const s=new Date;return new Date(t*1e3)<s},isExpiringSoon(t){const s=new Date,d=new Date(t*1e3),l=Math.ceil((d-s)/(1e3*60*60*24));return l<=7&&l>0},getExpiryStatusClass(t){return this.isExpired(t)?"text-danger":this.isExpiringSoon(t)?"text-warning":"text-success"},getExpiryStatusText(t){const s=new Date,d=new Date(t*1e3),l=Math.ceil((d-s)/(1e3*60*60*24));return l<0?`已過期 ${Math.abs(l)} 天`:l===0?"今天到期":l<=7?`${l} 天後到期`:"有效期限內"},getStatusBadgeClass(t){return t.is_enabled?this.isExpired(t.due_date)?"badge bg-danger":this.isExpiringSoon(t.due_date)?"badge bg-warning text-dark":"badge bg-success":"badge bg-secondary"},getStatusIcon(t){return t.is_enabled?this.isExpired(t.due_date)?"fas fa-times me-1":this.isExpiringSoon(t.due_date)?"fas fa-exclamation-triangle me-1":"fas fa-check me-1":"fas fa-pause me-1"},getStatusText(t){return t.is_enabled?this.isExpired(t.due_date)?"已過期":this.isExpiringSoon(t.due_date)?"即將到期":"啟用中":"已停用"}},mounted(){this.getCoupons()}},o=t=>(V("data-v-ac1018c8"),t=t(),P(),t),de={class:"row mb-4"},le={class:"col-md-3 mb-3"},ce={class:"card border-0 shadow-sm"},re={class:"card-body"},ue={class:"d-flex align-items-center"},pe={class:"flex-grow-1"},_e=o(()=>e("p",{class:"text-muted mb-1 small"},"總優惠券數",-1)),he={class:"mb-0 fw-bold"},me=o(()=>e("div",{class:"text-primary"},[e("i",{class:"fas fa-tickets-alt fa-2x"})],-1)),fe={class:"col-md-3 mb-3"},be={class:"card border-0 shadow-sm"},ge={class:"card-body"},xe={class:"d-flex align-items-center"},ve={class:"flex-grow-1"},ye=o(()=>e("p",{class:"text-muted mb-1 small"},"啟用中",-1)),Ce={class:"mb-0 fw-bold text-success"},we=o(()=>e("div",{class:"text-success"},[e("i",{class:"fas fa-check-circle fa-2x"})],-1)),Me={class:"col-md-3 mb-3"},Se={class:"card border-0 shadow-sm"},De={class:"card-body"},ke={class:"d-flex align-items-center"},Ee={class:"flex-grow-1"},Le=o(()=>e("p",{class:"text-muted mb-1 small"},"即將到期",-1)),Te={class:"mb-0 fw-bold text-warning"},Fe=o(()=>e("div",{class:"text-warning"},[e("i",{class:"fas fa-exclamation-triangle fa-2x"})],-1)),Ve={class:"col-md-3 mb-3"},Pe={class:"card border-0 shadow-sm"},Ie={class:"card-body"},Ae={class:"d-flex align-items-center"},Ne={class:"flex-grow-1"},Ue=o(()=>e("p",{class:"text-muted mb-1 small"},"已過期",-1)),Be={class:"mb-0 fw-bold text-danger"},$e=o(()=>e("div",{class:"text-danger"},[e("i",{class:"fas fa-times-circle fa-2x"})],-1)),Oe={class:"card border-0 shadow-sm mb-4"},Qe={class:"card-body"},je={class:"row g-3"},He={class:"col-md-4"},Re=o(()=>e("label",{class:"form-label small text-muted"},"搜尋優惠券",-1)),ze={class:"input-group"},qe=o(()=>e("span",{class:"input-group-text bg-light border-end-0"},[e("i",{class:"fas fa-search text-muted"})],-1)),We={class:"col-md-3"},Ge=o(()=>e("label",{class:"form-label small text-muted"},"啟用狀態",-1)),Je=o(()=>e("option",{value:""},"全部狀態",-1)),Ke=o(()=>e("option",{value:"enabled"},"啟用中",-1)),Xe=o(()=>e("option",{value:"disabled"},"已停用",-1)),Ye=[Je,Ke,Xe],Ze={class:"col-md-3"},et=o(()=>e("label",{class:"form-label small text-muted"},"有效期限",-1)),tt=o(()=>e("option",{value:""},"全部狀態",-1)),st=o(()=>e("option",{value:"valid"},"有效",-1)),ot=o(()=>e("option",{value:"expiring"},"即將到期",-1)),at=o(()=>e("option",{value:"expired"},"已過期",-1)),it=[tt,st,ot,at],nt={class:"col-md-2 d-flex align-items-end"},dt=o(()=>e("i",{class:"fas fa-refresh me-1"},null,-1)),lt={class:"card border-0 shadow-sm"},ct={class:"card-header bg-white border-bottom"},rt={class:"d-flex justify-content-between align-items-center"},ut=o(()=>e("h5",{class:"mb-0 fw-semibold"},"優惠券列表",-1)),pt={class:"d-flex align-items-center gap-3"},_t={class:"badge bg-light text-dark"},ht=o(()=>e("i",{class:"fas fa-plus me-1"},null,-1)),mt={class:"card-body p-0"},ft={class:"table-responsive"},bt={class:"table table-hover align-middle mb-0"},gt=o(()=>e("thead",{class:"bg-light"},[e("tr",null,[e("th",{class:"border-0 ps-4"},"優惠券名稱"),e("th",{class:"border-0"},"優惠券代碼"),e("th",{class:"border-0"},"折扣"),e("th",{class:"border-0"},"到期日"),e("th",{class:"border-0"},"狀態"),e("th",{class:"border-0 pe-4"},"操作")])],-1)),xt={class:"ps-4"},vt={class:"d-flex align-items-center"},yt=o(()=>e("div",{class:"avatar-sm rounded-circle bg-info bg-opacity-10 me-2 d-flex align-items-center justify-content-center"},[e("i",{class:"fas fa-ticket-alt text-info"})],-1)),Ct={class:"text-dark fw-medium"},wt={class:"bg-light text-dark px-2 py-1 rounded small"},Mt={class:"fw-bold text-success fs-5"},St=o(()=>e("small",{class:"text-muted d-block"},"折扣",-1)),Dt={class:"text-dark fw-medium"},kt={class:"pe-4"},Et={class:"btn-group"},Lt=["onClick"],Tt=o(()=>e("i",{class:"fas fa-edit"},null,-1)),Ft=[Tt],Vt=["onClick"],Pt=o(()=>e("i",{class:"fas fa-trash"},null,-1)),It=[Pt],At={key:0,class:"text-center py-5"},Nt=o(()=>e("i",{class:"fas fa-ticket-alt fa-3x text-muted mb-3"},null,-1)),Ut=o(()=>e("h5",{class:"text-muted"},"沒有找到符合條件的優惠券",-1)),Bt=o(()=>e("p",{class:"text-muted"},"請調整搜尋條件或建立新的優惠券",-1)),$t=[Nt,Ut,Bt];function Ot(t,s,d,l,a,i){const c=b("LoadingOverlay"),M=b("PageHeader"),S=b("CouponModal"),D=b("DelModal");return h(),m(C,null,[g(c,{active:a.isLoading},null,8,["active"]),g(M,{icon:"fas fa-ticket-alt","icon-color":"text-info",title:"優惠券管理",subtitle:"管理促銷優惠券，設定折扣與使用期限"}),e("div",de,[e("div",le,[e("div",ce,[e("div",re,[e("div",ue,[e("div",pe,[_e,e("h4",he,r(i.couponStats.total),1)]),me])])])]),e("div",fe,[e("div",be,[e("div",ge,[e("div",xe,[e("div",ve,[ye,e("h4",Ce,r(i.couponStats.active),1)]),we])])])]),e("div",Me,[e("div",Se,[e("div",De,[e("div",ke,[e("div",Ee,[Le,e("h4",Te,r(i.couponStats.expiringSoon),1)]),Fe])])])]),e("div",Ve,[e("div",Pe,[e("div",Ie,[e("div",Ae,[e("div",Ne,[Ue,e("h4",Be,r(i.couponStats.expired),1)]),$e])])])])]),e("div",Oe,[e("div",Qe,[e("div",je,[e("div",He,[Re,e("div",ze,[qe,u(e("input",{type:"text",class:"form-control border-start-0",placeholder:"搜尋優惠券名稱或代碼...","onUpdate:modelValue":s[0]||(s[0]=n=>a.searchQuery=n)},null,512),[[f,a.searchQuery]])])]),e("div",We,[Ge,u(e("select",{class:"form-select","onUpdate:modelValue":s[1]||(s[1]=n=>a.statusFilter=n)},Ye,512),[[y,a.statusFilter]])]),e("div",Ze,[et,u(e("select",{class:"form-select","onUpdate:modelValue":s[2]||(s[2]=n=>a.expiryFilter=n)},it,512),[[y,a.expiryFilter]])]),e("div",nt,[e("button",{class:"btn btn-outline-secondary w-100",onClick:s[3]||(s[3]=(...n)=>i.clearFilters&&i.clearFilters(...n))},[dt,x(" 清除 ")])])])])]),e("div",lt,[e("div",ct,[e("div",rt,[ut,e("div",pt,[e("span",_t,"共 "+r(i.filteredCoupons.length)+" 張優惠券",1),e("button",{class:"btn btn-primary btn-sm",type:"button",onClick:s[4]||(s[4]=n=>i.openCouponModal(!0))},[ht,x(" 建立新優惠券 ")])])])]),e("div",mt,[e("div",ft,[e("table",bt,[gt,e("tbody",null,[(h(!0),m(C,null,T(i.filteredCoupons,n=>(h(),m("tr",{key:n.id,class:"border-bottom"},[e("td",xt,[e("div",vt,[yt,e("div",null,[e("div",Ct,r(n.title),1)])])]),e("td",null,[e("code",wt,r(n.code),1)]),e("td",null,[e("span",Mt,r(n.percent)+"%",1),St]),e("td",null,[e("div",Dt,r(i.formatDate(n.due_date)),1),e("small",{class:v(i.getExpiryStatusClass(n.due_date))},r(i.getExpiryStatusText(n.due_date)),3)]),e("td",null,[e("span",{class:v(i.getStatusBadgeClass(n))},[e("i",{class:v(i.getStatusIcon(n))},null,2),x(" "+r(i.getStatusText(n)),1)],2)]),e("td",kt,[e("div",Et,[e("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:k=>i.openCouponModal(!1,n),title:"編輯優惠券"},Ft,8,Lt),e("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:k=>i.openDelCouponModal(n),title:"刪除優惠券"},It,8,Vt)])])]))),128))])]),i.filteredCoupons.length===0?(h(),m("div",At,$t)):F("",!0)])])]),g(S,{coupon:a.tempCoupon,isNew:a.isNew,ref:"couponModal",onUpdateCoupon:i.updateCoupon},null,8,["coupon","isNew","onUpdateCoupon"]),g(D,{ref:"delModal",item:a.tempCoupon,onDelItem:i.deleteCoupon},null,8,["item","onDelItem"])],64)}const qt=w(ne,[["render",Ot],["__scopeId","data-v-ac1018c8"]]);export{qt as default};
