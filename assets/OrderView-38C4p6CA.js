import{_ as g,o,c as d,b as e,t as l,n as x,F as b,h as y,l as O,x as M,a as P,r as h,d as p}from"./index-5uWLd9w3.js";import{u as D}from"./toastMessage-OX34INNF.js";import{m as $}from"./modalMixin-oa4G_Nah.js";import{D as L}from"./DelModal-3YjuZ0B5.js";const w={props:{order:{type:Object,default(){return{}}}},data(){return{status:{},modal:"",tempOrder:{},isPaid:!1}},emits:["update-paid"],mixins:[$],watch:{order(){this.tempOrder=this.order}}},C={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},V={class:"modal-dialog modal-xl",role:"document"},E={class:"modal-content border-0"},T=e("div",{class:"modal-header bg-dark text-white"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},[e("span",null,"訂單細節")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),A={class:"modal-body"},S={class:"row"},U={class:"col-md-4"},I=e("h3",null,"用戶資料",-1),N={class:"table"},R={key:0},B=e("th",{style:{width:"100px"}},"姓名",-1),j=e("th",null,"Email",-1),F=e("th",null,"電話",-1),H=e("th",null,"地址",-1),q={class:"col-md-8"},z=e("h3",null,"訂單細節",-1),G={class:"table"},J=e("th",{style:{width:"100px"}},"訂單編號",-1),K=e("th",null,"下單時間",-1),Q=e("th",null,"付款時間",-1),W={key:0},X={key:1},Y=e("th",null,"付款狀態",-1),Z={key:0,class:"text-success"},ee={key:1,class:"text-muted"},te=e("th",null,"總金額",-1),se=e("h3",null,"選購商品",-1),le={class:"table"},oe=e("thead",null,[e("tr")],-1),de={class:"text-end"},ne={class:"d-flex justify-content-end"},ae={class:"form-check"},re={class:"form-check-label",for:"flexCheckDefault"},ie={key:0},ce={key:1},ue={class:"modal-footer"},_e=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function he(s,n,i,u,t,c){return o(),d("div",C,[e("div",V,[e("div",E,[T,e("div",A,[e("div",S,[e("div",U,[I,e("table",N,[t.tempOrder.user?(o(),d("tbody",R,[e("tr",null,[B,e("td",null,l(t.tempOrder.user.name),1)]),e("tr",null,[j,e("td",null,l(t.tempOrder.user.email),1)]),e("tr",null,[F,e("td",null,l(t.tempOrder.user.tel),1)]),e("tr",null,[H,e("td",null,l(t.tempOrder.user.address),1)])])):x("",!0)])]),e("div",q,[z,e("table",G,[e("tbody",null,[e("tr",null,[J,e("td",null,l(t.tempOrder.id),1)]),e("tr",null,[K,e("td",null,l(s.$filters.date(t.tempOrder.create_at)),1)]),e("tr",null,[Q,e("td",null,[t.tempOrder.paid_date?(o(),d("span",W,l(s.$filters.date(t.tempOrder.paid_date)),1)):(o(),d("span",X,"時間不正確"))])]),e("tr",null,[Y,e("td",null,[t.tempOrder.is_paid?(o(),d("strong",Z,"已付款")):(o(),d("span",ee,"尚未付款"))])]),e("tr",null,[te,e("td",null,l(s.$filters.currency(t.tempOrder.total)),1)])])]),se,e("table",le,[oe,e("tbody",null,[(o(!0),d(b,null,y(t.tempOrder.products,r=>(o(),d("tr",{key:r.id},[e("th",null,l(r.product.title),1),e("td",null,l(r.qty)+" / "+l(r.product.unit),1),e("td",de,l(),1)]))),128))])]),e("div",ne,[e("div",ae,[O(e("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":n[0]||(n[0]=r=>t.tempOrder.is_paid=r)},null,512),[[M,t.tempOrder.is_paid]]),e("label",re,[t.tempOrder.is_paid?(o(),d("span",ie,"已付款")):(o(),d("span",ce,"未付款"))])])])])])]),e("div",ue,[_e,e("button",{type:"button",class:"btn btn-primary",onClick:n[1]||(n[1]=r=>s.$emit("update-paid",t.tempOrder))}," 修改付款狀態 ")])])])],512)}const pe=g(w,[["render",he]]);var me={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"ryanpro",BASE_URL:"/vue_practise_w7/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_URL:m,VITE_APP_PATH:f}=me,fe={data(){return{orders:{},currentPage:1,isLoading:!0,tempOrder:{},isNew:!1}},components:{OrderModal:pe,DelModal:L},methods:{...P(D,["addMessage"]),getOrders(s=1){this.currentPage=s;const n=`${m}/api/${f}/admin/orders?page=${s}`;this.axios.get(n).then(i=>{this.orders=i.data.orders}).catch(i=>{this.addMessage({title:"錯誤",content:i.response.data.message,style:"danger"})}).finally(()=>{this.isLoading=!1})},openModal(s){this.tempOrder={...s},this.isNew=!1,this.$refs.orderModal.openModal()},openDelModal(s){this.tempOrder={...s},this.$refs.delModal.openModal()},updatePaid(s){this.isLoading=!0;const n=`${m}/api/${f}/admin/order/${s.id}`,i={is_paid:s.is_paid};this.axios.put(n,{data:i}).then(u=>{this.$refs.orderModal.closeModal(),this.getOrders(this.currentPage),this.addMessage({title:"更新成功",content:u.data.message,style:"success"})}).catch(u=>{this.addMessage({title:"錯誤",content:u.response.data.message,style:"danger"})}).finally(()=>{this.isLoading=!1})},deleteOrder(){this.isLoading=!0;const s=`${m}/api/${f}/admin/order/${this.tempOrder.id}`;this.axios.delete(s).then(n=>{this.$refs.delModal.closeModal(),this.getOrders(this.currentPage),this.addMessage({title:"刪除成功",content:n.data.message,style:"success"})}).catch(n=>{this.addMessage({title:"錯誤",content:n.response.data.message,style:"danger"})}).finally(()=>{this.isLoading=!1})},formatDate(s){return new Date(s*1e3).toLocaleDateString()}},mounted(){this.getOrders()}},be=e("h2",null,"訂單列表",-1),ge={class:"table mt-4"},ye=e("thead",null,[e("tr",null,[e("th",null,"日期"),e("th",null,"Email"),e("th",null,"訂單編號"),e("th",null,"總額"),e("th",null,"備註"),e("th",null,"是否付款"),e("th",null,"編輯")])],-1),Oe={class:"text-right"},Me={class:"form-check form-switch"},ve=["id","onUpdate:modelValue","onChange"],ke=["for"],xe={key:0},Pe={key:1},De={class:"btn-group"},$e=["onClick"],Le=["onClick"];function we(s,n,i,u,t,c){const r=h("LoadingOverlay"),v=h("OrderModal"),k=h("DelModal");return o(),d(b,null,[p(r,{active:t.isLoading},null,8,["active"]),e("div",null,[be,e("table",ge,[ye,e("tbody",null,[(o(!0),d(b,null,y(t.orders,a=>(o(),d("tr",{key:a.id},[e("td",null,l(c.formatDate(a.create_at)),1),e("td",null,l(a.user.email),1),e("td",null,[e("span",null,l(a.id),1)]),e("td",null,l(a.total),1),e("td",Oe,l(a.message),1),e("td",null,[e("div",Me,[O(e("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${a.id}`,"onUpdate:modelValue":_=>a.is_paid=_,onChange:_=>c.updatePaid(a)},null,40,ve),[[M,a.is_paid]]),e("label",{class:"form-check-label",for:`paidSwitch${a.id}`},[a.is_paid?(o(),d("span",xe,"已付款")):(o(),d("span",Pe,"未付款"))],8,ke)])]),e("td",null,[e("div",De,[e("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:_=>c.openModal(a)}," 檢視 ",8,$e),e("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:_=>c.openDelModal(a)}," 刪除 ",8,Le)])])]))),128))])])]),p(v,{ref:"orderModal",order:t.tempOrder,onUpdatePaid:c.updatePaid},null,8,["order","onUpdatePaid"]),p(k,{ref:"delModal",item:t.tempOrder,onDelItem:c.deleteOrder},null,8,["item","onDelItem"])],64)}const Ae=g(fe,[["render",we]]);export{Ae as default};
